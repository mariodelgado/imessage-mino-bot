(()=>{var a={};a.id=240,a.ids=[240],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},77598:a=>{"use strict";a.exports=require("node:crypto")},78335:()=>{},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},89789:(a,b,c)=>{"use strict";let d,e,f;c.r(b),c.d(b,{handler:()=>cA,patchFetch:()=>cz,routeModule:()=>cv,serverHooks:()=>cy,workAsyncStorage:()=>cw,workUnitAsyncStorage:()=>cx});var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as={};c.r(as),c.d(as,{GET:()=>cu,maxDuration:()=>co,runtime:()=>cn});var at=c(95736),au=c(9117),av=c(4044),aw=c(39326),ax=c(32324),ay=c(261),az=c(54290),aA=c(85328),aB=c(38928),aC=c(46595),aD=c(3421),aE=c(17679),aF=c(41681),aG=c(63446),aH=c(86439),aI=c(51356),aJ=c(10641);function aK(a,b,c,d,e){if("m"===d)throw TypeError("Private method is not writable");if("a"===d&&!e)throw TypeError("Private accessor was defined without a setter");if("function"==typeof b?a!==b||!e:!b.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c}function aL(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)}let aM=function(){let{crypto:a}=globalThis;if(a?.randomUUID)return aM=a.randomUUID.bind(a),a.randomUUID();let b=new Uint8Array(1),c=a?()=>a.getRandomValues(b)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,a=>(a^c()&15>>a/4).toString(16))};function aN(a){return"object"==typeof a&&null!==a&&("name"in a&&"AbortError"===a.name||"message"in a&&String(a.message).includes("FetchRequestCanceledException"))}let aO=a=>{if(a instanceof Error)return a;if("object"==typeof a&&null!==a){try{if("[object Error]"===Object.prototype.toString.call(a)){let b=Error(a.message,a.cause?{cause:a.cause}:{});return a.stack&&(b.stack=a.stack),a.cause&&!b.cause&&(b.cause=a.cause),a.name&&(b.name=a.name),b}}catch{}try{return Error(JSON.stringify(a))}catch{}}return Error(a)};class aP extends Error{}class aQ extends aP{constructor(a,b,c,d){super(`${aQ.makeMessage(a,b,c)}`),this.status=a,this.headers=d,this.requestID=d?.get("request-id"),this.error=b}static makeMessage(a,b,c){let d=b?.message?"string"==typeof b.message?b.message:JSON.stringify(b.message):b?JSON.stringify(b):c;return a&&d?`${a} ${d}`:a?`${a} status code (no body)`:d||"(no status code or body)"}static generate(a,b,c,d){return a&&d?400===a?new aU(a,b,c,d):401===a?new aV(a,b,c,d):403===a?new aW(a,b,c,d):404===a?new aX(a,b,c,d):409===a?new aY(a,b,c,d):422===a?new aZ(a,b,c,d):429===a?new a$(a,b,c,d):a>=500?new a_(a,b,c,d):new aQ(a,b,c,d):new aS({message:c,cause:aO(b)})}}class aR extends aQ{constructor({message:a}={}){super(void 0,void 0,a||"Request was aborted.",void 0)}}class aS extends aQ{constructor({message:a,cause:b}){super(void 0,void 0,a||"Connection error.",void 0),b&&(this.cause=b)}}class aT extends aS{constructor({message:a}={}){super({message:a??"Request timed out."})}}class aU extends aQ{}class aV extends aQ{}class aW extends aQ{}class aX extends aQ{}class aY extends aQ{}class aZ extends aQ{}class a$ extends aQ{}class a_ extends aQ{}let a0=/^[a-z][a-z0-9+.-]*:/i,a1=a=>(a1=Array.isArray)(a),a2=a1;function a3(a){return"object"!=typeof a?{}:a??{}}let a4=a=>{try{return JSON.parse(a)}catch(a){return}},a5="0.71.2",a6=a=>"x32"===a?"x32":"x86_64"===a||"x64"===a?"x64":"arm"===a?"arm":"aarch64"===a||"arm64"===a?"arm64":a?`other:${a}`:"unknown",a7=a=>(a=a.toLowerCase()).includes("ios")?"iOS":"android"===a?"Android":"darwin"===a?"MacOS":"win32"===a?"Windows":"freebsd"===a?"FreeBSD":"openbsd"===a?"OpenBSD":"linux"===a?"Linux":a?`Other:${a}`:"Unknown";function a8(...a){let b=globalThis.ReadableStream;if(void 0===b)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new b(...a)}function a9(a){let b=Symbol.asyncIterator in a?a[Symbol.asyncIterator]():a[Symbol.iterator]();return a8({start(){},async pull(a){let{done:c,value:d}=await b.next();c?a.close():a.enqueue(d)},async cancel(){await b.return?.()}})}function ba(a){if(a[Symbol.asyncIterator])return a;let b=a.getReader();return{async next(){try{let a=await b.read();return a?.done&&b.releaseLock(),a}catch(a){throw b.releaseLock(),a}},async return(){let a=b.cancel();return b.releaseLock(),await a,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function bb(a){if(null===a||"object"!=typeof a)return;if(a[Symbol.asyncIterator])return void await a[Symbol.asyncIterator]().return?.();let b=a.getReader(),c=b.cancel();b.releaseLock(),await c}let bc=({headers:a,body:b})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(b)});function bd(a){let b;return(e??(e=(b=new globalThis.TextEncoder).encode.bind(b)))(a)}function be(a){let b;return(f??(f=(b=new globalThis.TextDecoder).decode.bind(b)))(a)}class bf{constructor(){g.set(this,void 0),h.set(this,void 0),aK(this,g,new Uint8Array,"f"),aK(this,h,null,"f")}decode(a){let b;if(null==a)return[];let c=a instanceof ArrayBuffer?new Uint8Array(a):"string"==typeof a?bd(a):a;aK(this,g,function(a){let b=0;for(let c of a)b+=c.length;let c=new Uint8Array(b),d=0;for(let b of a)c.set(b,d),d+=b.length;return c}([aL(this,g,"f"),c]),"f");let d=[];for(;null!=(b=function(a,b){for(let c=b??0;c<a.length;c++){if(10===a[c])return{preceding:c,index:c+1,carriage:!1};if(13===a[c])return{preceding:c,index:c+1,carriage:!0}}return null}(aL(this,g,"f"),aL(this,h,"f")));){if(b.carriage&&null==aL(this,h,"f")){aK(this,h,b.index,"f");continue}if(null!=aL(this,h,"f")&&(b.index!==aL(this,h,"f")+1||b.carriage)){d.push(be(aL(this,g,"f").subarray(0,aL(this,h,"f")-1))),aK(this,g,aL(this,g,"f").subarray(aL(this,h,"f")),"f"),aK(this,h,null,"f");continue}let a=null!==aL(this,h,"f")?b.preceding-1:b.preceding,c=be(aL(this,g,"f").subarray(0,a));d.push(c),aK(this,g,aL(this,g,"f").subarray(b.index),"f"),aK(this,h,null,"f")}return d}flush(){return aL(this,g,"f").length?this.decode("\n"):[]}}g=new WeakMap,h=new WeakMap,bf.NEWLINE_CHARS=new Set(["\n","\r"]),bf.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let bg={off:0,error:200,warn:300,info:400,debug:500},bh=(a,b,c)=>{if(a){if(Object.prototype.hasOwnProperty.call(bg,a))return a;bm(c).warn(`${b} was set to ${JSON.stringify(a)}, expected one of ${JSON.stringify(Object.keys(bg))}`)}};function bi(){}function bj(a,b,c){return!b||bg[a]>bg[c]?bi:b[a].bind(b)}let bk={error:bi,warn:bi,info:bi,debug:bi},bl=new WeakMap;function bm(a){let b=a.logger,c=a.logLevel??"off";if(!b)return bk;let d=bl.get(b);if(d&&d[0]===c)return d[1];let e={error:bj("error",b,c),warn:bj("warn",b,c),info:bj("info",b,c),debug:bj("debug",b,c)};return bl.set(b,[c,e]),e}let bn=a=>(a.options&&(a.options={...a.options},delete a.options.headers),a.headers&&(a.headers=Object.fromEntries((a.headers instanceof Headers?[...a.headers]:Object.entries(a.headers)).map(([a,b])=>[a,"x-api-key"===a.toLowerCase()||"authorization"===a.toLowerCase()||"cookie"===a.toLowerCase()||"set-cookie"===a.toLowerCase()?"***":b]))),"retryOfRequestLogID"in a&&(a.retryOfRequestLogID&&(a.retryOf=a.retryOfRequestLogID),delete a.retryOfRequestLogID),a);class bo{constructor(a,b,c){this.iterator=a,i.set(this,void 0),this.controller=b,aK(this,i,c,"f")}static fromSSEResponse(a,b,c){let d=!1,e=c?bm(c):console;async function*f(){if(d)throw new aP("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");d=!0;let c=!1;try{for await(let c of bp(a,b)){if("completion"===c.event)try{yield JSON.parse(c.data)}catch(a){throw e.error("Could not parse message into JSON:",c.data),e.error("From chunk:",c.raw),a}if("message_start"===c.event||"message_delta"===c.event||"message_stop"===c.event||"content_block_start"===c.event||"content_block_delta"===c.event||"content_block_stop"===c.event)try{yield JSON.parse(c.data)}catch(a){throw e.error("Could not parse message into JSON:",c.data),e.error("From chunk:",c.raw),a}if("ping"!==c.event&&"error"===c.event)throw new aQ(void 0,a4(c.data)??c.data,void 0,a.headers)}c=!0}catch(a){if(aN(a))return;throw a}finally{c||b.abort()}}return new bo(f,b,c)}static fromReadableStream(a,b,c){let d=!1;async function*e(){let b=new bf;for await(let c of ba(a))for(let a of b.decode(c))yield a;for(let a of b.flush())yield a}return new bo(async function*(){if(d)throw new aP("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");d=!0;let a=!1;try{for await(let b of e())!a&&b&&(yield JSON.parse(b));a=!0}catch(a){if(aN(a))return;throw a}finally{a||b.abort()}},b,c)}[(i=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let a=[],b=[],c=this.iterator(),d=d=>({next:()=>{if(0===d.length){let d=c.next();a.push(d),b.push(d)}return d.shift()}});return[new bo(()=>d(a),this.controller,aL(this,i,"f")),new bo(()=>d(b),this.controller,aL(this,i,"f"))]}toReadableStream(){let a,b=this;return a8({async start(){a=b[Symbol.asyncIterator]()},async pull(b){try{let{value:c,done:d}=await a.next();if(d)return b.close();let e=bd(JSON.stringify(c)+"\n");b.enqueue(e)}catch(a){b.error(a)}},async cancel(){await a.return?.()}})}}async function*bp(a,b){if(!a.body){if(b.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new aP("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new aP("Attempted to iterate over a response with no body")}let c=new br,d=new bf;for await(let b of bq(ba(a.body)))for(let a of d.decode(b)){let b=c.decode(a);b&&(yield b)}for(let a of d.flush()){let b=c.decode(a);b&&(yield b)}}async function*bq(a){let b=new Uint8Array;for await(let c of a){let a;if(null==c)continue;let d=c instanceof ArrayBuffer?new Uint8Array(c):"string"==typeof c?bd(c):c,e=new Uint8Array(b.length+d.length);for(e.set(b),e.set(d,b.length),b=e;-1!==(a=function(a){for(let b=0;b<a.length-1;b++){if(10===a[b]&&10===a[b+1]||13===a[b]&&13===a[b+1])return b+2;if(13===a[b]&&10===a[b+1]&&b+3<a.length&&13===a[b+2]&&10===a[b+3])return b+4}return -1}(b));)yield b.slice(0,a),b=b.slice(a)}b.length>0&&(yield b)}class br{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(a){if(a.endsWith("\r")&&(a=a.substring(0,a.length-1)),!a){if(!this.event&&!this.data.length)return null;let a={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(a),a.startsWith(":"))return null;let[b,c,d]=function(a,b){let c=a.indexOf(":");return -1!==c?[a.substring(0,c),b,a.substring(c+b.length)]:[a,"",""]}(a,":");return d.startsWith(" ")&&(d=d.substring(1)),"event"===b?this.event=d:"data"===b&&this.data.push(d),null}}async function bs(a,b){let{response:c,requestLogID:d,retryOfRequestLogID:e,startTime:f}=b,g=await (async()=>{if(b.options.stream)return(bm(a).debug("response",c.status,c.url,c.headers,c.body),b.options.__streamClass)?b.options.__streamClass.fromSSEResponse(c,b.controller):bo.fromSSEResponse(c,b.controller);if(204===c.status)return null;if(b.options.__binaryResponse)return c;let d=c.headers.get("content-type"),e=d?.split(";")[0]?.trim();return e?.includes("application/json")||e?.endsWith("+json")?bt(await c.json(),c):await c.text()})();return bm(a).debug(`[${d}] response parsed`,bn({retryOfRequestLogID:e,url:c.url,status:c.status,body:g,durationMs:Date.now()-f})),g}function bt(a,b){return!a||"object"!=typeof a||Array.isArray(a)?a:Object.defineProperty(a,"_request_id",{value:b.headers.get("request-id"),enumerable:!1})}class bu extends Promise{constructor(a,b,c=bs){super(a=>{a(null)}),this.responsePromise=b,this.parseResponse=c,j.set(this,void 0),aK(this,j,a,"f")}_thenUnwrap(a){return new bu(aL(this,j,"f"),this.responsePromise,async(b,c)=>bt(a(await this.parseResponse(b,c),c),c.response))}asResponse(){return this.responsePromise.then(a=>a.response)}async withResponse(){let[a,b]=await Promise.all([this.parse(),this.asResponse()]);return{data:a,response:b,request_id:b.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(a=>this.parseResponse(aL(this,j,"f"),a))),this.parsedPromise}then(a,b){return this.parse().then(a,b)}catch(a){return this.parse().catch(a)}finally(a){return this.parse().finally(a)}}j=new WeakMap;class bv{constructor(a,b,c,d){k.set(this,void 0),aK(this,k,a,"f"),this.options=d,this.response=b,this.body=c}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let a=this.nextPageRequestOptions();if(!a)throw new aP("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await aL(this,k,"f").requestAPIList(this.constructor,a)}async *iterPages(){let a=this;for(yield a;a.hasNextPage();)a=await a.getNextPage(),yield a}async *[(k=new WeakMap,Symbol.asyncIterator)](){for await(let a of this.iterPages())for(let b of a.getPaginatedItems())yield b}}class bw extends bu{constructor(a,b,c){super(a,b,async(a,b)=>new c(a,b.response,await bs(a,b),b.options))}async *[Symbol.asyncIterator](){for await(let a of(await this))yield a}}class bx extends bv{constructor(a,b,c,d){super(a,b,c,d),this.data=c.data||[],this.has_more=c.has_more||!1,this.first_id=c.first_id||null,this.last_id=c.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){if(this.options.query?.before_id){let a=this.first_id;return a?{...this.options,query:{...a3(this.options.query),before_id:a}}:null}let a=this.last_id;return a?{...this.options,query:{...a3(this.options.query),after_id:a}}:null}}class by extends bv{constructor(a,b,c,d){super(a,b,c,d),this.data=c.data||[],this.has_more=c.has_more||!1,this.next_page=c.next_page||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let a=this.next_page;return a?{...this.options,query:{...a3(this.options.query),page:a}}:null}}let bz=()=>{if("undefined"==typeof File){let{process:a}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof a?.versions?.node&&20>parseInt(a.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function bA(a,b,c){return bz(),new File(a,b??"unknown_file",c)}function bB(a){return("object"==typeof a&&null!==a&&("name"in a&&a.name&&String(a.name)||"url"in a&&a.url&&String(a.url)||"filename"in a&&a.filename&&String(a.filename)||"path"in a&&a.path&&String(a.path))||"").split(/[\\/]/).pop()||void 0}let bC=a=>null!=a&&"object"==typeof a&&"function"==typeof a[Symbol.asyncIterator],bD=async(a,b)=>({...a,body:await bF(a.body,b)}),bE=new WeakMap,bF=async(a,b)=>{if(!await function(a){let b="function"==typeof a?a:a.fetch,c=bE.get(b);if(c)return c;let d=(async()=>{try{let a="Response"in b?b.Response:(await b("data:,")).constructor,c=new FormData;if(c.toString()===await new a(c).text())return!1;return!0}catch{return!0}})();return bE.set(b,d),d}(b))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let c=new FormData;return await Promise.all(Object.entries(a||{}).map(([a,b])=>bI(c,a,b))),c},bG=a=>a instanceof Blob&&"name"in a,bH=a=>{if((a=>"object"==typeof a&&null!==a&&(a instanceof Response||bC(a)||bG(a)))(a))return!0;if(Array.isArray(a))return a.some(bH);if(a&&"object"==typeof a){for(let b in a)if(bH(a[b]))return!0}return!1},bI=async(a,b,c)=>{if(void 0!==c){if(null==c)throw TypeError(`Received null for "${b}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof c||"number"==typeof c||"boolean"==typeof c)a.append(b,String(c));else if(c instanceof Response){let d={},e=c.headers.get("Content-Type");e&&(d={type:e}),a.append(b,bA([await c.blob()],bB(c),d))}else if(bC(c))a.append(b,bA([await new Response(a9(c)).blob()],bB(c)));else if(bG(c))a.append(b,bA([c],bB(c),{type:c.type}));else if(Array.isArray(c))await Promise.all(c.map(c=>bI(a,b+"[]",c)));else if("object"==typeof c)await Promise.all(Object.entries(c).map(([c,d])=>bI(a,`${b}[${c}]`,d)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${c} instead`)}},bJ=a=>null!=a&&"object"==typeof a&&"number"==typeof a.size&&"string"==typeof a.type&&"function"==typeof a.text&&"function"==typeof a.slice&&"function"==typeof a.arrayBuffer;async function bK(a,b,c){let d,e;if(bz(),a=await a,b||(b=bB(a)),null!=(d=a)&&"object"==typeof d&&"string"==typeof d.name&&"number"==typeof d.lastModified&&bJ(d))return a instanceof File&&null==b&&null==c?a:bA([await a.arrayBuffer()],b??a.name,{type:a.type,lastModified:a.lastModified,...c});if(null!=(e=a)&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob){let d=await a.blob();return b||(b=new URL(a.url).pathname.split(/[\\/]/).pop()),bA(await bL(d),b,c)}let f=await bL(a);if(!c?.type){let a=f.find(a=>"object"==typeof a&&"type"in a&&a.type);"string"==typeof a&&(c={...c,type:a})}return bA(f,b,c)}async function bL(a){let b=[];if("string"==typeof a||ArrayBuffer.isView(a)||a instanceof ArrayBuffer)b.push(a);else if(bJ(a))b.push(a instanceof Blob?a:await a.arrayBuffer());else if(bC(a))for await(let c of a)b.push(...await bL(c));else{let b=a?.constructor?.name;throw Error(`Unexpected data type: ${typeof a}${b?`; constructor: ${b}`:""}${function(a){if("object"!=typeof a||null===a)return"";let b=Object.getOwnPropertyNames(a);return`; props: [${b.map(a=>`"${a}"`).join(", ")}]`}(a)}`)}return b}class bM{constructor(a){this._client=a}}let bN=Symbol.for("brand.privateNullableHeaders"),bO=a=>{let b=new Headers,c=new Set;for(let d of a){let a=new Set;for(let[e,f]of function*(a){let b;if(!a)return;if(bN in a){let{values:b,nulls:c}=a;for(let a of(yield*b.entries(),c))yield[a,null];return}let c=!1;for(let d of(a instanceof Headers?b=a.entries():a2(a)?b=a:(c=!0,b=Object.entries(a??{})),b)){let a=d[0];if("string"!=typeof a)throw TypeError("expected header name to be a string");let b=a2(d[1])?d[1]:[d[1]],e=!1;for(let d of b)void 0!==d&&(c&&!e&&(e=!0,yield[a,null]),yield[a,d])}}(d)){let d=e.toLowerCase();a.has(d)||(b.delete(e),a.add(d)),null===f?(b.delete(e),c.add(d)):(b.append(e,f),c.delete(d))}}return{[bN]:!0,values:b,nulls:c}};function bP(a){return a.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let bQ=Object.freeze(Object.create(null)),bR=((a=bP)=>function(b,...c){let d;if(1===b.length)return b[0];let e=!1,f=[],g=b.reduce((b,d,g)=>{/[?#]/.test(d)&&(e=!0);let h=c[g],i=(e?encodeURIComponent:a)(""+h);return g!==c.length&&(null==h||"object"==typeof h&&h.toString===Object.getPrototypeOf(Object.getPrototypeOf(h.hasOwnProperty??bQ)??bQ)?.toString)&&(i=h+"",f.push({start:b.length+d.length,length:i.length,error:`Value of type ${Object.prototype.toString.call(h).slice(8,-1)} is not a valid path parameter`})),b+d+(g===c.length?"":i)},""),h=g.split(/[?#]/,1)[0],i=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(d=i.exec(h));)f.push({start:d.index,length:d[0].length,error:`Value "${d[0]}" can't be safely passed as a path parameter`});if(f.sort((a,b)=>a.start-b.start),f.length>0){let a=0,b=f.reduce((b,c)=>{let d=" ".repeat(c.start-a),e="^".repeat(c.length);return a=c.start+c.length,b+d+e},"");throw new aP(`Path parameters result in path with invalid segments:
${f.map(a=>a.error).join("\n")}
${g}
${b}`)}return g})(bP);class bS extends bM{list(a={},b){let{betas:c,...d}=a??{};return this._client.getAPIList("/v1/files",bx,{query:d,...b,headers:bO([{"anthropic-beta":[...c??[],"files-api-2025-04-14"].toString()},b?.headers])})}delete(a,b={},c){let{betas:d}=b??{};return this._client.delete(bR`/v1/files/${a}`,{...c,headers:bO([{"anthropic-beta":[...d??[],"files-api-2025-04-14"].toString()},c?.headers])})}download(a,b={},c){let{betas:d}=b??{};return this._client.get(bR`/v1/files/${a}/content`,{...c,headers:bO([{"anthropic-beta":[...d??[],"files-api-2025-04-14"].toString(),Accept:"application/binary"},c?.headers]),__binaryResponse:!0})}retrieveMetadata(a,b={},c){let{betas:d}=b??{};return this._client.get(bR`/v1/files/${a}`,{...c,headers:bO([{"anthropic-beta":[...d??[],"files-api-2025-04-14"].toString()},c?.headers])})}upload(a,b){let{betas:c,...d}=a;return this._client.post("/v1/files",bD({body:d,...b,headers:bO([{"anthropic-beta":[...c??[],"files-api-2025-04-14"].toString()},b?.headers])},this._client))}}class bT extends bM{retrieve(a,b={},c){let{betas:d}=b??{};return this._client.get(bR`/v1/models/${a}?beta=true`,{...c,headers:bO([{...d?.toString()!=null?{"anthropic-beta":d?.toString()}:void 0},c?.headers])})}list(a={},b){let{betas:c,...d}=a??{};return this._client.getAPIList("/v1/models?beta=true",bx,{query:d,...b,headers:bO([{...c?.toString()!=null?{"anthropic-beta":c?.toString()}:void 0},b?.headers])})}}let bU={"claude-opus-4-20250514":8192,"claude-opus-4-0":8192,"claude-4-opus-20250514":8192,"anthropic.claude-opus-4-20250514-v1:0":8192,"claude-opus-4@20250514":8192,"claude-opus-4-1-20250805":8192,"anthropic.claude-opus-4-1-20250805-v1:0":8192,"claude-opus-4-1@20250805":8192};function bV(a,b,c){return b&&"parse"in(b.output_format??{})?bW(a,b,c):{...a,content:a.content.map(a=>"text"===a.type?Object.defineProperty(Object.defineProperty({...a},"parsed_output",{value:null,enumerable:!1}),"parsed",{get:()=>(c.logger.warn("The `parsed` property on `text` blocks is deprecated, please use `parsed_output` instead."),null),enumerable:!1}):a),parsed_output:null}}function bW(a,b,c){let d=null,e=a.content.map(a=>{if("text"===a.type){let e=function(a,b){if(a.output_format?.type!=="json_schema")return null;try{if("parse"in a.output_format)return a.output_format.parse(b);return JSON.parse(b)}catch(a){throw new aP(`Failed to parse structured output: ${a}`)}}(b,a.text);return null===d&&(d=e),Object.defineProperty(Object.defineProperty({...a},"parsed_output",{value:e,enumerable:!1}),"parsed",{get:()=>(c.logger.warn("The `parsed` property on `text` blocks is deprecated, please use `parsed_output` instead."),e),enumerable:!1})}return a});return{...a,content:e,parsed_output:d}}let bX=a=>{if(0===a.length)return a;let b=a[a.length-1];switch(b.type){case"separator":return bX(a=a.slice(0,a.length-1));case"number":let c=b.value[b.value.length-1];if("."===c||"-"===c)return bX(a=a.slice(0,a.length-1));case"string":let d=a[a.length-2];if(d?.type==="delimiter"||d?.type==="brace"&&"{"===d.value)return bX(a=a.slice(0,a.length-1));break;case"delimiter":return bX(a=a.slice(0,a.length-1))}return a},bY=a=>JSON.parse((a=>{let b="";return a.map(a=>{"string"===a.type?b+='"'+a.value+'"':b+=a.value}),b})((a=>{let b=[];return a.map(a=>{"brace"===a.type&&("{"===a.value?b.push("}"):b.splice(b.lastIndexOf("}"),1)),"paren"===a.type&&("["===a.value?b.push("]"):b.splice(b.lastIndexOf("]"),1))}),b.length>0&&b.reverse().map(b=>{"}"===b?a.push({type:"brace",value:"}"}):"]"===b&&a.push({type:"paren",value:"]"})}),a})(bX((a=>{let b=0,c=[];for(;b<a.length;){let d=a[b];if("\\"===d){b++;continue}if("{"===d){c.push({type:"brace",value:"{"}),b++;continue}if("}"===d){c.push({type:"brace",value:"}"}),b++;continue}if("["===d){c.push({type:"paren",value:"["}),b++;continue}if("]"===d){c.push({type:"paren",value:"]"}),b++;continue}if(":"===d){c.push({type:"separator",value:":"}),b++;continue}if(","===d){c.push({type:"delimiter",value:","}),b++;continue}if('"'===d){let e="",f=!1;for(d=a[++b];'"'!==d;){if(b===a.length){f=!0;break}if("\\"===d){if(++b===a.length){f=!0;break}e+=d+a[b],d=a[++b]}else e+=d,d=a[++b]}d=a[++b],f||c.push({type:"string",value:e});continue}let e=/\s/;if(d&&e.test(d)){b++;continue}let f=/[0-9]/;if(d&&f.test(d)||"-"===d||"."===d){let e="";for("-"===d&&(e+=d,d=a[++b]);d&&f.test(d)||"."===d;)e+=d,d=a[++b];c.push({type:"number",value:e});continue}let g=/[a-z]/i;if(d&&g.test(d)){let e="";for(;d&&g.test(d)&&b!==a.length;)e+=d,d=a[++b];"true"==e||"false"==e||"null"===e?c.push({type:"name",value:e}):b++;continue}b++}return c})(a))))),bZ="__json_buf";function b$(a){return"tool_use"===a.type||"server_tool_use"===a.type||"mcp_tool_use"===a.type}class b_{constructor(a,b){l.add(this),this.messages=[],this.receivedMessages=[],m.set(this,void 0),n.set(this,null),this.controller=new AbortController,o.set(this,void 0),p.set(this,()=>{}),q.set(this,()=>{}),r.set(this,void 0),s.set(this,()=>{}),t.set(this,()=>{}),u.set(this,{}),v.set(this,!1),w.set(this,!1),x.set(this,!1),y.set(this,!1),z.set(this,void 0),A.set(this,void 0),B.set(this,void 0),E.set(this,a=>{if(aK(this,w,!0,"f"),aN(a)&&(a=new aR),a instanceof aR)return aK(this,x,!0,"f"),this._emit("abort",a);if(a instanceof aP)return this._emit("error",a);if(a instanceof Error){let b=new aP(a.message);return b.cause=a,this._emit("error",b)}return this._emit("error",new aP(String(a)))}),aK(this,o,new Promise((a,b)=>{aK(this,p,a,"f"),aK(this,q,b,"f")}),"f"),aK(this,r,new Promise((a,b)=>{aK(this,s,a,"f"),aK(this,t,b,"f")}),"f"),aL(this,o,"f").catch(()=>{}),aL(this,r,"f").catch(()=>{}),aK(this,n,a,"f"),aK(this,B,b?.logger??console,"f")}get response(){return aL(this,z,"f")}get request_id(){return aL(this,A,"f")}async withResponse(){aK(this,y,!0,"f");let a=await aL(this,o,"f");if(!a)throw Error("Could not resolve a `Response` object");return{data:this,response:a,request_id:a.headers.get("request-id")}}static fromReadableStream(a){let b=new b_(null);return b._run(()=>b._fromReadableStream(a)),b}static createMessage(a,b,c,{logger:d}={}){let e=new b_(b,{logger:d});for(let a of b.messages)e._addMessageParam(a);return aK(e,n,{...b,stream:!0},"f"),e._run(()=>e._createMessage(a,{...b,stream:!0},{...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"stream"}})),e}_run(a){a().then(()=>{this._emitFinal(),this._emit("end")},aL(this,E,"f"))}_addMessageParam(a){this.messages.push(a)}_addMessage(a,b=!0){this.receivedMessages.push(a),b&&this._emit("message",a)}async _createMessage(a,b,c){let d,e=c?.signal;e&&(e.aborted&&this.controller.abort(),d=this.controller.abort.bind(this.controller),e.addEventListener("abort",d));try{aL(this,l,"m",F).call(this);let{response:d,data:e}=await a.create({...b,stream:!0},{...c,signal:this.controller.signal}).withResponse();for await(let a of(this._connected(d),e))aL(this,l,"m",G).call(this,a);if(e.controller.signal?.aborted)throw new aR;aL(this,l,"m",H).call(this)}finally{e&&d&&e.removeEventListener("abort",d)}}_connected(a){this.ended||(aK(this,z,a,"f"),aK(this,A,a?.headers.get("request-id"),"f"),aL(this,p,"f").call(this,a),this._emit("connect"))}get ended(){return aL(this,v,"f")}get errored(){return aL(this,w,"f")}get aborted(){return aL(this,x,"f")}abort(){this.controller.abort()}on(a,b){return(aL(this,u,"f")[a]||(aL(this,u,"f")[a]=[])).push({listener:b}),this}off(a,b){let c=aL(this,u,"f")[a];if(!c)return this;let d=c.findIndex(a=>a.listener===b);return d>=0&&c.splice(d,1),this}once(a,b){return(aL(this,u,"f")[a]||(aL(this,u,"f")[a]=[])).push({listener:b,once:!0}),this}emitted(a){return new Promise((b,c)=>{aK(this,y,!0,"f"),"error"!==a&&this.once("error",c),this.once(a,b)})}async done(){aK(this,y,!0,"f"),await aL(this,r,"f")}get currentMessage(){return aL(this,m,"f")}async finalMessage(){return await this.done(),aL(this,l,"m",C).call(this)}async finalText(){return await this.done(),aL(this,l,"m",D).call(this)}_emit(a,...b){if(aL(this,v,"f"))return;"end"===a&&(aK(this,v,!0,"f"),aL(this,s,"f").call(this));let c=aL(this,u,"f")[a];if(c&&(aL(this,u,"f")[a]=c.filter(a=>!a.once),c.forEach(({listener:a})=>a(...b))),"abort"===a){let a=b[0];aL(this,y,"f")||c?.length||Promise.reject(a),aL(this,q,"f").call(this,a),aL(this,t,"f").call(this,a),this._emit("end");return}if("error"===a){let a=b[0];aL(this,y,"f")||c?.length||Promise.reject(a),aL(this,q,"f").call(this,a),aL(this,t,"f").call(this,a),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",aL(this,l,"m",C).call(this))}async _fromReadableStream(a,b){let c,d=b?.signal;d&&(d.aborted&&this.controller.abort(),c=this.controller.abort.bind(this.controller),d.addEventListener("abort",c));try{aL(this,l,"m",F).call(this),this._connected(null);let b=bo.fromReadableStream(a,this.controller);for await(let a of b)aL(this,l,"m",G).call(this,a);if(b.controller.signal?.aborted)throw new aR;aL(this,l,"m",H).call(this)}finally{d&&c&&d.removeEventListener("abort",c)}}[(m=new WeakMap,n=new WeakMap,o=new WeakMap,p=new WeakMap,q=new WeakMap,r=new WeakMap,s=new WeakMap,t=new WeakMap,u=new WeakMap,v=new WeakMap,w=new WeakMap,x=new WeakMap,y=new WeakMap,z=new WeakMap,A=new WeakMap,B=new WeakMap,E=new WeakMap,l=new WeakSet,C=function(){if(0===this.receivedMessages.length)throw new aP("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},D=function(){if(0===this.receivedMessages.length)throw new aP("stream ended without producing a Message with role=assistant");let a=this.receivedMessages.at(-1).content.filter(a=>"text"===a.type).map(a=>a.text);if(0===a.length)throw new aP("stream ended without producing a content block with type=text");return a.join(" ")},F=function(){this.ended||aK(this,m,void 0,"f")},G=function(a){if(this.ended)return;let b=aL(this,l,"m",I).call(this,a);switch(this._emit("streamEvent",a,b),a.type){case"content_block_delta":{let c=b.content.at(-1);switch(a.delta.type){case"text_delta":"text"===c.type&&this._emit("text",a.delta.text,c.text||"");break;case"citations_delta":"text"===c.type&&this._emit("citation",a.delta.citation,c.citations??[]);break;case"input_json_delta":b$(c)&&c.input&&this._emit("inputJson",a.delta.partial_json,c.input);break;case"thinking_delta":"thinking"===c.type&&this._emit("thinking",a.delta.thinking,c.thinking);break;case"signature_delta":"thinking"===c.type&&this._emit("signature",c.signature);break;default:a.delta}break}case"message_stop":this._addMessageParam(b),this._addMessage(bV(b,aL(this,n,"f"),{logger:aL(this,B,"f")}),!0);break;case"content_block_stop":this._emit("contentBlock",b.content.at(-1));break;case"message_start":aK(this,m,b,"f")}},H=function(){if(this.ended)throw new aP("stream has ended, this shouldn't happen");let a=aL(this,m,"f");if(!a)throw new aP("request ended without sending any chunks");return aK(this,m,void 0,"f"),bV(a,aL(this,n,"f"),{logger:aL(this,B,"f")})},I=function(a){let b=aL(this,m,"f");if("message_start"===a.type){if(b)throw new aP(`Unexpected event order, got ${a.type} before receiving "message_stop"`);return a.message}if(!b)throw new aP(`Unexpected event order, got ${a.type} before "message_start"`);switch(a.type){case"message_stop":case"content_block_stop":return b;case"message_delta":return b.container=a.delta.container,b.stop_reason=a.delta.stop_reason,b.stop_sequence=a.delta.stop_sequence,b.usage.output_tokens=a.usage.output_tokens,b.context_management=a.context_management,null!=a.usage.input_tokens&&(b.usage.input_tokens=a.usage.input_tokens),null!=a.usage.cache_creation_input_tokens&&(b.usage.cache_creation_input_tokens=a.usage.cache_creation_input_tokens),null!=a.usage.cache_read_input_tokens&&(b.usage.cache_read_input_tokens=a.usage.cache_read_input_tokens),null!=a.usage.server_tool_use&&(b.usage.server_tool_use=a.usage.server_tool_use),b;case"content_block_start":return b.content.push(a.content_block),b;case"content_block_delta":{let c=b.content.at(a.index);switch(a.delta.type){case"text_delta":c?.type==="text"&&(b.content[a.index]={...c,text:(c.text||"")+a.delta.text});break;case"citations_delta":c?.type==="text"&&(b.content[a.index]={...c,citations:[...c.citations??[],a.delta.citation]});break;case"input_json_delta":if(c&&b$(c)){let d=c[bZ]||"";d+=a.delta.partial_json;let e={...c};if(Object.defineProperty(e,bZ,{value:d,enumerable:!1,writable:!0}),d)try{e.input=bY(d)}catch(b){let a=new aP(`Unable to parse tool parameter JSON from model. Please retry your request or adjust your prompt. Error: ${b}. JSON: ${d}`);aL(this,E,"f").call(this,a)}b.content[a.index]=e}break;case"thinking_delta":c?.type==="thinking"&&(b.content[a.index]={...c,thinking:c.thinking+a.delta.thinking});break;case"signature_delta":c?.type==="thinking"&&(b.content[a.index]={...c,signature:a.delta.signature});break;default:a.delta}return b}}},Symbol.asyncIterator)](){let a=[],b=[],c=!1;return this.on("streamEvent",c=>{let d=b.shift();d?d.resolve(c):a.push(c)}),this.on("end",()=>{for(let a of(c=!0,b))a.resolve(void 0);b.length=0}),this.on("abort",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),this.on("error",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),{next:async()=>a.length?{value:a.shift(),done:!1}:c?{value:void 0,done:!0}:new Promise((a,c)=>b.push({resolve:a,reject:c})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new bo(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}let b0=`You have been working on the task described above but have not yet completed it. Write a continuation summary that will allow you (or another instance of yourself) to resume work efficiently in a future context window where the conversation history will be replaced with this summary. Your summary should be structured, concise, and actionable. Include:
1. Task Overview
The user's core request and success criteria
Any clarifications or constraints they specified
2. Current State
What has been completed so far
Files created, modified, or analyzed (with paths if relevant)
Key outputs or artifacts produced
3. Important Discoveries
Technical constraints or requirements uncovered
Decisions made and their rationale
Errors encountered and how they were resolved
What approaches were tried that didn't work (and why)
4. Next Steps
Specific actions needed to complete the task
Any blockers or open questions to resolve
Priority order if multiple steps remain
5. Context to Preserve
User preferences or style requirements
Domain-specific details that aren't obvious
Any promises made to the user
Be concise but completeâ€”err on the side of including information that would prevent duplicate work or repeated mistakes. Write in a way that enables immediate resumption of the task.
Wrap your summary in <summary></summary> tags.`;function b1(){let a,b;return{promise:new Promise((c,d)=>{a=c,b=d}),resolve:a,reject:b}}class b2{constructor(a,b,c){J.add(this),this.client=a,K.set(this,!1),L.set(this,!1),M.set(this,void 0),N.set(this,void 0),O.set(this,void 0),P.set(this,void 0),Q.set(this,void 0),R.set(this,0),aK(this,M,{params:{...b,messages:structuredClone(b.messages)}},"f"),aK(this,N,{...c,headers:bO([{"x-stainless-helper":"BetaToolRunner"},c?.headers])},"f"),aK(this,Q,b1(),"f")}async *[(K=new WeakMap,L=new WeakMap,M=new WeakMap,N=new WeakMap,O=new WeakMap,P=new WeakMap,Q=new WeakMap,R=new WeakMap,J=new WeakSet,S=async function(){let a=aL(this,M,"f").params.compactionControl;if(!a||!a.enabled)return!1;let b=0;if(void 0!==aL(this,O,"f"))try{let a=await aL(this,O,"f");b=a.usage.input_tokens+(a.usage.cache_creation_input_tokens??0)+(a.usage.cache_read_input_tokens??0)+a.usage.output_tokens}catch{return!1}if(b<(a.contextTokenThreshold??1e5))return!1;let c=a.model??aL(this,M,"f").params.model,d=a.summaryPrompt??b0,e=aL(this,M,"f").params.messages;if("assistant"===e[e.length-1].role){let a=e[e.length-1];if(Array.isArray(a.content)){let b=a.content.filter(a=>"tool_use"!==a.type);0===b.length?e.pop():a.content=b}}let f=await this.client.beta.messages.create({model:c,messages:[...e,{role:"user",content:[{type:"text",text:d}]}],max_tokens:aL(this,M,"f").params.max_tokens},{headers:{"x-stainless-helper":"compaction"}});if(f.content[0]?.type!=="text")throw new aP("Expected text response for compaction");return aL(this,M,"f").params.messages=[{role:"user",content:f.content}],!0},Symbol.asyncIterator)](){var a;if(aL(this,K,"f"))throw new aP("Cannot iterate over a consumed stream");aK(this,K,!0,"f"),aK(this,L,!0,"f"),aK(this,P,void 0,"f");try{for(;;){let b;try{if(aL(this,M,"f").params.max_iterations&&aL(this,R,"f")>=aL(this,M,"f").params.max_iterations)break;aK(this,L,!1,"f"),aK(this,P,void 0,"f"),aK(this,R,(a=aL(this,R,"f"),++a),"f"),aK(this,O,void 0,"f");let{max_iterations:c,compactionControl:d,...e}=aL(this,M,"f").params;if(e.stream?(b=this.client.beta.messages.stream({...e},aL(this,N,"f")),aK(this,O,b.finalMessage(),"f"),aL(this,O,"f").catch(()=>{}),yield b):(aK(this,O,this.client.beta.messages.create({...e,stream:!1},aL(this,N,"f")),"f"),yield aL(this,O,"f")),!await aL(this,J,"m",S).call(this)){if(!aL(this,L,"f")){let{role:a,content:b}=await aL(this,O,"f");aL(this,M,"f").params.messages.push({role:a,content:b})}let a=await aL(this,J,"m",T).call(this,aL(this,M,"f").params.messages.at(-1));if(a)aL(this,M,"f").params.messages.push(a);else if(!aL(this,L,"f"))break}}finally{b&&b.abort()}}if(!aL(this,O,"f"))throw new aP("ToolRunner concluded without a message from the server");aL(this,Q,"f").resolve(await aL(this,O,"f"))}catch(a){throw aK(this,K,!1,"f"),aL(this,Q,"f").promise.catch(()=>{}),aL(this,Q,"f").reject(a),aK(this,Q,b1(),"f"),a}}setMessagesParams(a){"function"==typeof a?aL(this,M,"f").params=a(aL(this,M,"f").params):aL(this,M,"f").params=a,aK(this,L,!0,"f"),aK(this,P,void 0,"f")}async generateToolResponse(){let a=await aL(this,O,"f")??this.params.messages.at(-1);return a?aL(this,J,"m",T).call(this,a):null}done(){return aL(this,Q,"f").promise}async runUntilDone(){if(!aL(this,K,"f"))for await(let a of this);return this.done()}get params(){return aL(this,M,"f").params}pushMessages(...a){this.setMessagesParams(b=>({...b,messages:[...b.messages,...a]}))}then(a,b){return this.runUntilDone().then(a,b)}}async function b3(a,b=a.messages.at(-1)){if(!b||"assistant"!==b.role||!b.content||"string"==typeof b.content)return null;let c=b.content.filter(a=>"tool_use"===a.type);return 0===c.length?null:{role:"user",content:await Promise.all(c.map(async b=>{let c=a.tools.find(a=>("name"in a?a.name:a.mcp_server_name)===b.name);if(!c||!("run"in c))return{type:"tool_result",tool_use_id:b.id,content:`Error: Tool '${b.name}' not found`,is_error:!0};try{let a=b.input;"parse"in c&&c.parse&&(a=c.parse(a));let d=await c.run(a);return{type:"tool_result",tool_use_id:b.id,content:d}}catch(a){return{type:"tool_result",tool_use_id:b.id,content:`Error: ${a instanceof Error?a.message:String(a)}`,is_error:!0}}}))}}T=async function(a){return void 0!==aL(this,P,"f")||aK(this,P,b3(aL(this,M,"f").params,a),"f"),aL(this,P,"f")};class b4{constructor(a,b){this.iterator=a,this.controller=b}async *decoder(){let a=new bf;for await(let b of this.iterator)for(let c of a.decode(b))yield JSON.parse(c);for(let b of a.flush())yield JSON.parse(b)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(a,b){if(!a.body){if(b.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new aP("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new aP("Attempted to iterate over a response with no body")}return new b4(ba(a.body),b)}}class b5 extends bM{create(a,b){let{betas:c,...d}=a;return this._client.post("/v1/messages/batches?beta=true",{body:d,...b,headers:bO([{"anthropic-beta":[...c??[],"message-batches-2024-09-24"].toString()},b?.headers])})}retrieve(a,b={},c){let{betas:d}=b??{};return this._client.get(bR`/v1/messages/batches/${a}?beta=true`,{...c,headers:bO([{"anthropic-beta":[...d??[],"message-batches-2024-09-24"].toString()},c?.headers])})}list(a={},b){let{betas:c,...d}=a??{};return this._client.getAPIList("/v1/messages/batches?beta=true",bx,{query:d,...b,headers:bO([{"anthropic-beta":[...c??[],"message-batches-2024-09-24"].toString()},b?.headers])})}delete(a,b={},c){let{betas:d}=b??{};return this._client.delete(bR`/v1/messages/batches/${a}?beta=true`,{...c,headers:bO([{"anthropic-beta":[...d??[],"message-batches-2024-09-24"].toString()},c?.headers])})}cancel(a,b={},c){let{betas:d}=b??{};return this._client.post(bR`/v1/messages/batches/${a}/cancel?beta=true`,{...c,headers:bO([{"anthropic-beta":[...d??[],"message-batches-2024-09-24"].toString()},c?.headers])})}async results(a,b={},c){let d=await this.retrieve(a);if(!d.results_url)throw new aP(`No batch \`results_url\`; Has it finished processing? ${d.processing_status} - ${d.id}`);let{betas:e}=b??{};return this._client.get(d.results_url,{...c,headers:bO([{"anthropic-beta":[...e??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary"},c?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((a,b)=>b4.fromResponse(b.response,b.controller))}}let b6={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-7-sonnet-latest":"February 19th, 2026","claude-3-7-sonnet-20250219":"February 19th, 2026"};class b7 extends bM{constructor(){super(...arguments),this.batches=new b5(this._client)}create(a,b){let{betas:c,...d}=a;d.model in b6&&console.warn(`The model '${d.model}' is deprecated and will reach end-of-life on ${b6[d.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let e=this._client._options.timeout;if(!d.stream&&null==e){let a=bU[d.model]??void 0;e=this._client.calculateNonstreamingTimeout(d.max_tokens,a)}return this._client.post("/v1/messages?beta=true",{body:d,timeout:e??6e5,...b,headers:bO([{...c?.toString()!=null?{"anthropic-beta":c?.toString()}:void 0},b?.headers]),stream:a.stream??!1})}parse(a,b){return b={...b,headers:bO([{"anthropic-beta":[...a.betas??[],"structured-outputs-2025-11-13"].toString()},b?.headers])},this.create(a,b).then(b=>bW(b,a,{logger:this._client.logger??console}))}stream(a,b){return b_.createMessage(this,a,b)}countTokens(a,b){let{betas:c,...d}=a;return this._client.post("/v1/messages/count_tokens?beta=true",{body:d,...b,headers:bO([{"anthropic-beta":[...c??[],"token-counting-2024-11-01"].toString()},b?.headers])})}toolRunner(a,b){return new b2(this._client,a,b)}}b7.Batches=b5,b7.BetaToolRunner=b2;class b8 extends bM{create(a,b={},c){let{betas:d,...e}=b??{};return this._client.post(bR`/v1/skills/${a}/versions?beta=true`,bD({body:e,...c,headers:bO([{"anthropic-beta":[...d??[],"skills-2025-10-02"].toString()},c?.headers])},this._client))}retrieve(a,b,c){let{skill_id:d,betas:e}=b;return this._client.get(bR`/v1/skills/${d}/versions/${a}?beta=true`,{...c,headers:bO([{"anthropic-beta":[...e??[],"skills-2025-10-02"].toString()},c?.headers])})}list(a,b={},c){let{betas:d,...e}=b??{};return this._client.getAPIList(bR`/v1/skills/${a}/versions?beta=true`,by,{query:e,...c,headers:bO([{"anthropic-beta":[...d??[],"skills-2025-10-02"].toString()},c?.headers])})}delete(a,b,c){let{skill_id:d,betas:e}=b;return this._client.delete(bR`/v1/skills/${d}/versions/${a}?beta=true`,{...c,headers:bO([{"anthropic-beta":[...e??[],"skills-2025-10-02"].toString()},c?.headers])})}}class b9 extends bM{constructor(){super(...arguments),this.versions=new b8(this._client)}create(a={},b){let{betas:c,...d}=a??{};return this._client.post("/v1/skills?beta=true",bD({body:d,...b,headers:bO([{"anthropic-beta":[...c??[],"skills-2025-10-02"].toString()},b?.headers])},this._client))}retrieve(a,b={},c){let{betas:d}=b??{};return this._client.get(bR`/v1/skills/${a}?beta=true`,{...c,headers:bO([{"anthropic-beta":[...d??[],"skills-2025-10-02"].toString()},c?.headers])})}list(a={},b){let{betas:c,...d}=a??{};return this._client.getAPIList("/v1/skills?beta=true",by,{query:d,...b,headers:bO([{"anthropic-beta":[...c??[],"skills-2025-10-02"].toString()},b?.headers])})}delete(a,b={},c){let{betas:d}=b??{};return this._client.delete(bR`/v1/skills/${a}?beta=true`,{...c,headers:bO([{"anthropic-beta":[...d??[],"skills-2025-10-02"].toString()},c?.headers])})}}b9.Versions=b8;class ca extends bM{constructor(){super(...arguments),this.models=new bT(this._client),this.messages=new b7(this._client),this.files=new bS(this._client),this.skills=new b9(this._client)}}ca.Models=bT,ca.Messages=b7,ca.Files=bS,ca.Skills=b9;class cb extends bM{create(a,b){let{betas:c,...d}=a;return this._client.post("/v1/complete",{body:d,timeout:this._client._options.timeout??6e5,...b,headers:bO([{...c?.toString()!=null?{"anthropic-beta":c?.toString()}:void 0},b?.headers]),stream:a.stream??!1})}}let cc="__json_buf";function cd(a){return"tool_use"===a.type||"server_tool_use"===a.type}class ce{constructor(){U.add(this),this.messages=[],this.receivedMessages=[],V.set(this,void 0),this.controller=new AbortController,W.set(this,void 0),X.set(this,()=>{}),Y.set(this,()=>{}),Z.set(this,void 0),$.set(this,()=>{}),_.set(this,()=>{}),aa.set(this,{}),ab.set(this,!1),ac.set(this,!1),ad.set(this,!1),ae.set(this,!1),af.set(this,void 0),ag.set(this,void 0),aj.set(this,a=>{if(aK(this,ac,!0,"f"),aN(a)&&(a=new aR),a instanceof aR)return aK(this,ad,!0,"f"),this._emit("abort",a);if(a instanceof aP)return this._emit("error",a);if(a instanceof Error){let b=new aP(a.message);return b.cause=a,this._emit("error",b)}return this._emit("error",new aP(String(a)))}),aK(this,W,new Promise((a,b)=>{aK(this,X,a,"f"),aK(this,Y,b,"f")}),"f"),aK(this,Z,new Promise((a,b)=>{aK(this,$,a,"f"),aK(this,_,b,"f")}),"f"),aL(this,W,"f").catch(()=>{}),aL(this,Z,"f").catch(()=>{})}get response(){return aL(this,af,"f")}get request_id(){return aL(this,ag,"f")}async withResponse(){aK(this,ae,!0,"f");let a=await aL(this,W,"f");if(!a)throw Error("Could not resolve a `Response` object");return{data:this,response:a,request_id:a.headers.get("request-id")}}static fromReadableStream(a){let b=new ce;return b._run(()=>b._fromReadableStream(a)),b}static createMessage(a,b,c){let d=new ce;for(let a of b.messages)d._addMessageParam(a);return d._run(()=>d._createMessage(a,{...b,stream:!0},{...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"stream"}})),d}_run(a){a().then(()=>{this._emitFinal(),this._emit("end")},aL(this,aj,"f"))}_addMessageParam(a){this.messages.push(a)}_addMessage(a,b=!0){this.receivedMessages.push(a),b&&this._emit("message",a)}async _createMessage(a,b,c){let d,e=c?.signal;e&&(e.aborted&&this.controller.abort(),d=this.controller.abort.bind(this.controller),e.addEventListener("abort",d));try{aL(this,U,"m",ak).call(this);let{response:d,data:e}=await a.create({...b,stream:!0},{...c,signal:this.controller.signal}).withResponse();for await(let a of(this._connected(d),e))aL(this,U,"m",al).call(this,a);if(e.controller.signal?.aborted)throw new aR;aL(this,U,"m",am).call(this)}finally{e&&d&&e.removeEventListener("abort",d)}}_connected(a){this.ended||(aK(this,af,a,"f"),aK(this,ag,a?.headers.get("request-id"),"f"),aL(this,X,"f").call(this,a),this._emit("connect"))}get ended(){return aL(this,ab,"f")}get errored(){return aL(this,ac,"f")}get aborted(){return aL(this,ad,"f")}abort(){this.controller.abort()}on(a,b){return(aL(this,aa,"f")[a]||(aL(this,aa,"f")[a]=[])).push({listener:b}),this}off(a,b){let c=aL(this,aa,"f")[a];if(!c)return this;let d=c.findIndex(a=>a.listener===b);return d>=0&&c.splice(d,1),this}once(a,b){return(aL(this,aa,"f")[a]||(aL(this,aa,"f")[a]=[])).push({listener:b,once:!0}),this}emitted(a){return new Promise((b,c)=>{aK(this,ae,!0,"f"),"error"!==a&&this.once("error",c),this.once(a,b)})}async done(){aK(this,ae,!0,"f"),await aL(this,Z,"f")}get currentMessage(){return aL(this,V,"f")}async finalMessage(){return await this.done(),aL(this,U,"m",ah).call(this)}async finalText(){return await this.done(),aL(this,U,"m",ai).call(this)}_emit(a,...b){if(aL(this,ab,"f"))return;"end"===a&&(aK(this,ab,!0,"f"),aL(this,$,"f").call(this));let c=aL(this,aa,"f")[a];if(c&&(aL(this,aa,"f")[a]=c.filter(a=>!a.once),c.forEach(({listener:a})=>a(...b))),"abort"===a){let a=b[0];aL(this,ae,"f")||c?.length||Promise.reject(a),aL(this,Y,"f").call(this,a),aL(this,_,"f").call(this,a),this._emit("end");return}if("error"===a){let a=b[0];aL(this,ae,"f")||c?.length||Promise.reject(a),aL(this,Y,"f").call(this,a),aL(this,_,"f").call(this,a),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",aL(this,U,"m",ah).call(this))}async _fromReadableStream(a,b){let c,d=b?.signal;d&&(d.aborted&&this.controller.abort(),c=this.controller.abort.bind(this.controller),d.addEventListener("abort",c));try{aL(this,U,"m",ak).call(this),this._connected(null);let b=bo.fromReadableStream(a,this.controller);for await(let a of b)aL(this,U,"m",al).call(this,a);if(b.controller.signal?.aborted)throw new aR;aL(this,U,"m",am).call(this)}finally{d&&c&&d.removeEventListener("abort",c)}}[(V=new WeakMap,W=new WeakMap,X=new WeakMap,Y=new WeakMap,Z=new WeakMap,$=new WeakMap,_=new WeakMap,aa=new WeakMap,ab=new WeakMap,ac=new WeakMap,ad=new WeakMap,ae=new WeakMap,af=new WeakMap,ag=new WeakMap,aj=new WeakMap,U=new WeakSet,ah=function(){if(0===this.receivedMessages.length)throw new aP("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},ai=function(){if(0===this.receivedMessages.length)throw new aP("stream ended without producing a Message with role=assistant");let a=this.receivedMessages.at(-1).content.filter(a=>"text"===a.type).map(a=>a.text);if(0===a.length)throw new aP("stream ended without producing a content block with type=text");return a.join(" ")},ak=function(){this.ended||aK(this,V,void 0,"f")},al=function(a){if(this.ended)return;let b=aL(this,U,"m",an).call(this,a);switch(this._emit("streamEvent",a,b),a.type){case"content_block_delta":{let c=b.content.at(-1);switch(a.delta.type){case"text_delta":"text"===c.type&&this._emit("text",a.delta.text,c.text||"");break;case"citations_delta":"text"===c.type&&this._emit("citation",a.delta.citation,c.citations??[]);break;case"input_json_delta":cd(c)&&c.input&&this._emit("inputJson",a.delta.partial_json,c.input);break;case"thinking_delta":"thinking"===c.type&&this._emit("thinking",a.delta.thinking,c.thinking);break;case"signature_delta":"thinking"===c.type&&this._emit("signature",c.signature);break;default:a.delta}break}case"message_stop":this._addMessageParam(b),this._addMessage(b,!0);break;case"content_block_stop":this._emit("contentBlock",b.content.at(-1));break;case"message_start":aK(this,V,b,"f")}},am=function(){if(this.ended)throw new aP("stream has ended, this shouldn't happen");let a=aL(this,V,"f");if(!a)throw new aP("request ended without sending any chunks");return aK(this,V,void 0,"f"),a},an=function(a){let b=aL(this,V,"f");if("message_start"===a.type){if(b)throw new aP(`Unexpected event order, got ${a.type} before receiving "message_stop"`);return a.message}if(!b)throw new aP(`Unexpected event order, got ${a.type} before "message_start"`);switch(a.type){case"message_stop":case"content_block_stop":return b;case"message_delta":return b.stop_reason=a.delta.stop_reason,b.stop_sequence=a.delta.stop_sequence,b.usage.output_tokens=a.usage.output_tokens,null!=a.usage.input_tokens&&(b.usage.input_tokens=a.usage.input_tokens),null!=a.usage.cache_creation_input_tokens&&(b.usage.cache_creation_input_tokens=a.usage.cache_creation_input_tokens),null!=a.usage.cache_read_input_tokens&&(b.usage.cache_read_input_tokens=a.usage.cache_read_input_tokens),null!=a.usage.server_tool_use&&(b.usage.server_tool_use=a.usage.server_tool_use),b;case"content_block_start":return b.content.push({...a.content_block}),b;case"content_block_delta":{let c=b.content.at(a.index);switch(a.delta.type){case"text_delta":c?.type==="text"&&(b.content[a.index]={...c,text:(c.text||"")+a.delta.text});break;case"citations_delta":c?.type==="text"&&(b.content[a.index]={...c,citations:[...c.citations??[],a.delta.citation]});break;case"input_json_delta":if(c&&cd(c)){let d=c[cc]||"";d+=a.delta.partial_json;let e={...c};Object.defineProperty(e,cc,{value:d,enumerable:!1,writable:!0}),d&&(e.input=bY(d)),b.content[a.index]=e}break;case"thinking_delta":c?.type==="thinking"&&(b.content[a.index]={...c,thinking:c.thinking+a.delta.thinking});break;case"signature_delta":c?.type==="thinking"&&(b.content[a.index]={...c,signature:a.delta.signature});break;default:a.delta}return b}}},Symbol.asyncIterator)](){let a=[],b=[],c=!1;return this.on("streamEvent",c=>{let d=b.shift();d?d.resolve(c):a.push(c)}),this.on("end",()=>{for(let a of(c=!0,b))a.resolve(void 0);b.length=0}),this.on("abort",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),this.on("error",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),{next:async()=>a.length?{value:a.shift(),done:!1}:c?{value:void 0,done:!0}:new Promise((a,c)=>b.push({resolve:a,reject:c})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new bo(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}class cf extends bM{create(a,b){return this._client.post("/v1/messages/batches",{body:a,...b})}retrieve(a,b){return this._client.get(bR`/v1/messages/batches/${a}`,b)}list(a={},b){return this._client.getAPIList("/v1/messages/batches",bx,{query:a,...b})}delete(a,b){return this._client.delete(bR`/v1/messages/batches/${a}`,b)}cancel(a,b){return this._client.post(bR`/v1/messages/batches/${a}/cancel`,b)}async results(a,b){let c=await this.retrieve(a);if(!c.results_url)throw new aP(`No batch \`results_url\`; Has it finished processing? ${c.processing_status} - ${c.id}`);return this._client.get(c.results_url,{...b,headers:bO([{Accept:"application/binary"},b?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((a,b)=>b4.fromResponse(b.response,b.controller))}}class cg extends bM{constructor(){super(...arguments),this.batches=new cf(this._client)}create(a,b){a.model in ch&&console.warn(`The model '${a.model}' is deprecated and will reach end-of-life on ${ch[a.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let c=this._client._options.timeout;if(!a.stream&&null==c){let b=bU[a.model]??void 0;c=this._client.calculateNonstreamingTimeout(a.max_tokens,b)}return this._client.post("/v1/messages",{body:a,timeout:c??6e5,...b,stream:a.stream??!1})}stream(a,b){return ce.createMessage(this,a,b)}countTokens(a,b){return this._client.post("/v1/messages/count_tokens",{body:a,...b})}}let ch={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-7-sonnet-latest":"February 19th, 2026","claude-3-7-sonnet-20250219":"February 19th, 2026"};cg.Batches=cf;class ci extends bM{retrieve(a,b={},c){let{betas:d}=b??{};return this._client.get(bR`/v1/models/${a}`,{...c,headers:bO([{...d?.toString()!=null?{"anthropic-beta":d?.toString()}:void 0},c?.headers])})}list(a={},b){let{betas:c,...d}=a??{};return this._client.getAPIList("/v1/models",bx,{query:d,...b,headers:bO([{...c?.toString()!=null?{"anthropic-beta":c?.toString()}:void 0},b?.headers])})}}let cj=a=>void 0!==globalThis.process?globalThis.process.env?.[a]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(a)?.trim():void 0;class ck{constructor({baseURL:a=cj("ANTHROPIC_BASE_URL"),apiKey:b=cj("ANTHROPIC_API_KEY")??null,authToken:c=cj("ANTHROPIC_AUTH_TOKEN")??null,...d}={}){ao.add(this),aq.set(this,void 0);let e={apiKey:b,authToken:c,...d,baseURL:a||"https://api.anthropic.com"};if(!e.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new aP("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew Anthropic({ apiKey, dangerouslyAllowBrowser: true });\n");this.baseURL=e.baseURL,this.timeout=e.timeout??ap.DEFAULT_TIMEOUT,this.logger=e.logger??console;let f="warn";this.logLevel=f,this.logLevel=bh(e.logLevel,"ClientOptions.logLevel",this)??bh(cj("ANTHROPIC_LOG"),"process.env['ANTHROPIC_LOG']",this)??f,this.fetchOptions=e.fetchOptions,this.maxRetries=e.maxRetries??2,this.fetch=e.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Anthropic({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),aK(this,aq,bc,"f"),this._options=e,this.apiKey="string"==typeof b?b:null,this.authToken=c}withOptions(a){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,authToken:this.authToken,...a})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:a,nulls:b}){if(!(a.get("x-api-key")||a.get("authorization")||this.apiKey&&a.get("x-api-key")||b.has("x-api-key")||this.authToken&&a.get("authorization"))&&!b.has("authorization"))throw Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}async authHeaders(a){return bO([await this.apiKeyAuth(a),await this.bearerAuth(a)])}async apiKeyAuth(a){if(null!=this.apiKey)return bO([{"X-Api-Key":this.apiKey}])}async bearerAuth(a){if(null!=this.authToken)return bO([{Authorization:`Bearer ${this.authToken}`}])}stringifyQuery(a){return Object.entries(a).filter(([a,b])=>void 0!==b).map(([a,b])=>{if("string"==typeof b||"number"==typeof b||"boolean"==typeof b)return`${encodeURIComponent(a)}=${encodeURIComponent(b)}`;if(null===b)return`${encodeURIComponent(a)}=`;throw new aP(`Cannot stringify type ${typeof b}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${a5}`}defaultIdempotencyKey(){return`stainless-node-retry-${aM()}`}makeStatusError(a,b,c,d){return aQ.generate(a,b,c,d)}buildURL(a,b,c){let d=!aL(this,ao,"m",ar).call(this)&&c||this.baseURL,e=new URL(a0.test(a)?a:d+(d.endsWith("/")&&a.startsWith("/")?a.slice(1):a)),f=this.defaultQuery();return!function(a){if(!a)return!0;for(let b in a)return!1;return!0}(f)&&(b={...f,...b}),"object"==typeof b&&b&&!Array.isArray(b)&&(e.search=this.stringifyQuery(b)),e.toString()}_calculateNonstreamingTimeout(a){if(3600*a/128e3>600)throw new aP("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#streaming-responses for more details");return 6e5}async prepareOptions(a){}async prepareRequest(a,{url:b,options:c}){}get(a,b){return this.methodRequest("get",a,b)}post(a,b){return this.methodRequest("post",a,b)}patch(a,b){return this.methodRequest("patch",a,b)}put(a,b){return this.methodRequest("put",a,b)}delete(a,b){return this.methodRequest("delete",a,b)}methodRequest(a,b,c){return this.request(Promise.resolve(c).then(c=>({method:a,path:b,...c})))}request(a,b=null){return new bu(this,this.makeRequest(a,b,void 0))}async makeRequest(a,b,c){let d=await a,e=d.maxRetries??this.maxRetries;null==b&&(b=e),await this.prepareOptions(d);let{req:f,url:g,timeout:h}=await this.buildRequest(d,{retryCount:e-b});await this.prepareRequest(f,{url:g,options:d});let i="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),j=void 0===c?"":`, retryOf: ${c}`,k=Date.now();if(bm(this).debug(`[${i}] sending request`,bn({retryOfRequestLogID:c,method:d.method,url:g,options:d,headers:f.headers})),d.signal?.aborted)throw new aR;let l=new AbortController,m=await this.fetchWithTimeout(g,f,h,l).catch(aO),n=Date.now();if(m instanceof globalThis.Error){let a=`retrying, ${b} attempts remaining`;if(d.signal?.aborted)throw new aR;let e=aN(m)||/timed? ?out/i.test(String(m)+("cause"in m?String(m.cause):""));if(b)return bm(this).info(`[${i}] connection ${e?"timed out":"failed"} - ${a}`),bm(this).debug(`[${i}] connection ${e?"timed out":"failed"} (${a})`,bn({retryOfRequestLogID:c,url:g,durationMs:n-k,message:m.message})),this.retryRequest(d,b,c??i);if(bm(this).info(`[${i}] connection ${e?"timed out":"failed"} - error; no more retries left`),bm(this).debug(`[${i}] connection ${e?"timed out":"failed"} (error; no more retries left)`,bn({retryOfRequestLogID:c,url:g,durationMs:n-k,message:m.message})),e)throw new aT;throw new aS({cause:m})}let o=[...m.headers.entries()].filter(([a])=>"request-id"===a).map(([a,b])=>", "+a+": "+JSON.stringify(b)).join(""),p=`[${i}${j}${o}] ${f.method} ${g} ${m.ok?"succeeded":"failed"} with status ${m.status} in ${n-k}ms`;if(!m.ok){let a=await this.shouldRetry(m);if(b&&a){let a=`retrying, ${b} attempts remaining`;return await bb(m.body),bm(this).info(`${p} - ${a}`),bm(this).debug(`[${i}] response error (${a})`,bn({retryOfRequestLogID:c,url:m.url,status:m.status,headers:m.headers,durationMs:n-k})),this.retryRequest(d,b,c??i,m.headers)}let e=a?"error; no more retries left":"error; not retryable";bm(this).info(`${p} - ${e}`);let f=await m.text().catch(a=>aO(a).message),g=a4(f),h=g?void 0:f;throw bm(this).debug(`[${i}] response error (${e})`,bn({retryOfRequestLogID:c,url:m.url,status:m.status,headers:m.headers,message:h,durationMs:Date.now()-k})),this.makeStatusError(m.status,g,h,m.headers)}return bm(this).info(p),bm(this).debug(`[${i}] response start`,bn({retryOfRequestLogID:c,url:m.url,status:m.status,headers:m.headers,durationMs:n-k})),{response:m,options:d,controller:l,requestLogID:i,retryOfRequestLogID:c,startTime:k}}getAPIList(a,b,c){return this.requestAPIList(b,{method:"get",path:a,...c})}requestAPIList(a,b){return new bw(this,this.makeRequest(b,null,void 0),a)}async fetchWithTimeout(a,b,c,d){let{signal:e,method:f,...g}=b||{};e&&e.addEventListener("abort",()=>d.abort());let h=setTimeout(()=>d.abort(),c),i=globalThis.ReadableStream&&g.body instanceof globalThis.ReadableStream||"object"==typeof g.body&&null!==g.body&&Symbol.asyncIterator in g.body,j={signal:d.signal,...i?{duplex:"half"}:{},method:"GET",...g};f&&(j.method=f.toUpperCase());try{return await this.fetch.call(void 0,a,j)}finally{clearTimeout(h)}}async shouldRetry(a){let b=a.headers.get("x-should-retry");return"true"===b||"false"!==b&&(408===a.status||409===a.status||429===a.status||!!(a.status>=500))}async retryRequest(a,b,c,d){let e,f,g=d?.get("retry-after-ms");if(g){let a=parseFloat(g);Number.isNaN(a)||(e=a)}let h=d?.get("retry-after");if(h&&!e){let a=parseFloat(h);e=Number.isNaN(a)?Date.parse(h)-Date.now():1e3*a}if(!(e&&0<=e&&e<6e4)){let c=a.maxRetries??this.maxRetries;e=this.calculateDefaultRetryTimeoutMillis(b,c)}return await (f=e,new Promise(a=>setTimeout(a,f))),this.makeRequest(a,b-1,c)}calculateDefaultRetryTimeoutMillis(a,b){return Math.min(.5*Math.pow(2,b-a),8)*(1-.25*Math.random())*1e3}calculateNonstreamingTimeout(a,b){if(36e5*a/128e3>6e5||null!=b&&a>b)throw new aP("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#long-requests for more details");return 6e5}async buildRequest(a,{retryCount:b=0}={}){let c={...a},{method:d,path:e,query:f,defaultBaseURL:g}=c,h=this.buildURL(e,f,g);"timeout"in c&&((a,b)=>{if("number"!=typeof b||!Number.isInteger(b))throw new aP(`${a} must be an integer`);if(b<0)throw new aP(`${a} must be a positive integer`)})("timeout",c.timeout),c.timeout=c.timeout??this.timeout;let{bodyHeaders:i,body:j}=this.buildBody({options:c}),k=await this.buildHeaders({options:a,method:d,bodyHeaders:i,retryCount:b});return{req:{method:d,headers:k,...c.signal&&{signal:c.signal},...globalThis.ReadableStream&&j instanceof globalThis.ReadableStream&&{duplex:"half"},...j&&{body:j},...this.fetchOptions??{},...c.fetchOptions??{}},url:h,timeout:c.timeout}}async buildHeaders({options:a,method:b,bodyHeaders:c,retryCount:e}){let f={};this.idempotencyHeader&&"get"!==b&&(a.idempotencyKey||(a.idempotencyKey=this.defaultIdempotencyKey()),f[this.idempotencyHeader]=a.idempotencyKey);let g=bO([f,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(e),...a.timeout?{"X-Stainless-Timeout":String(Math.trunc(a.timeout/1e3))}:{},...d??(d=(()=>{let a="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===a)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":a5,"X-Stainless-OS":a7(Deno.build.os),"X-Stainless-Arch":a6(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":a5,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===a)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":a5,"X-Stainless-OS":a7(globalThis.process.platform??"unknown"),"X-Stainless-Arch":a6(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let b=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:a,pattern:b}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let c=b.exec(navigator.userAgent);if(c){let b=c[1]||0,d=c[2]||0,e=c[3]||0;return{browser:a,version:`${b}.${d}.${e}`}}}return null}();return b?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":a5,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${b.browser}`,"X-Stainless-Runtime-Version":b.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":a5,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01"},await this.authHeaders(a),this._options.defaultHeaders,c,a.headers]);return this.validateHeaders(g),g.values}buildBody({options:{body:a,headers:b}}){if(!a)return{bodyHeaders:void 0,body:void 0};let c=bO([b]);return ArrayBuffer.isView(a)||a instanceof ArrayBuffer||a instanceof DataView||"string"==typeof a&&c.values.has("content-type")||globalThis.Blob&&a instanceof globalThis.Blob||a instanceof FormData||a instanceof URLSearchParams||globalThis.ReadableStream&&a instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:a}:"object"==typeof a&&(Symbol.asyncIterator in a||Symbol.iterator in a&&"next"in a&&"function"==typeof a.next)?{bodyHeaders:void 0,body:a9(a)}:aL(this,aq,"f").call(this,{body:a,headers:c})}}ap=ck,aq=new WeakMap,ao=new WeakSet,ar=function(){return"https://api.anthropic.com"!==this.baseURL},ck.Anthropic=ap,ck.HUMAN_PROMPT="\\n\\nHuman:",ck.AI_PROMPT="\\n\\nAssistant:",ck.DEFAULT_TIMEOUT=6e5,ck.AnthropicError=aP,ck.APIError=aQ,ck.APIConnectionError=aS,ck.APIConnectionTimeoutError=aT,ck.APIUserAbortError=aR,ck.NotFoundError=aX,ck.ConflictError=aY,ck.RateLimitError=a$,ck.BadRequestError=aU,ck.AuthenticationError=aV,ck.InternalServerError=a_,ck.PermissionDeniedError=aW,ck.UnprocessableEntityError=aZ,ck.toFile=bK;class cl extends ck{constructor(){super(...arguments),this.completions=new cb(this),this.messages=new cg(this),this.models=new ci(this),this.beta=new ca(this)}}cl.Completions=cb,cl.Messages=cg,cl.Models=ci,cl.Beta=ca;var cm=c(79461);let cn="nodejs",co=300,cp=new cl;async function cq(a){let b=`Search for the most recent news about "${a}" in the last 7 days.

Focus on:
1. Breaking news and major developments
2. Industry trends and analysis
3. Funding, M&A, and business moves
4. Expert insights

Return ONLY a JSON object:
{
  "query": "${a}",
  "headlines": [
    {
      "title": "Headline text",
      "url": "https://url.com",
      "source": "Publication",
      "snippet": "Brief summary"
    }
  ]
}

Return up to 3 most important headlines.`;try{let c=await cp.messages.create({model:"claude-sonnet-4-20250514",max_tokens:1e3,tools:[{type:"web_search_20250305",name:"web_search",max_uses:3}],messages:[{role:"user",content:b}]}),d="";for(let a of c.content)"text"===a.type&&(d+=a.text);let e=d.match(/\{[\s\S]*"headlines"[\s\S]*\}/);if(e)return JSON.parse(e[0]);return{query:a,headlines:[]}}catch(b){return console.error(`Search failed for ${a}:`,b),{query:a,headlines:[]}}}async function cr(a){let b=[...a.topics.slice(0,3),...a.companies.slice(0,3).map(a=>`${a} company`)],c=[];for(let a of b){let b=await cq(a);b.headlines.length>0&&c.push(b),await new Promise(a=>setTimeout(a,1e3))}let d=[];for(let a of c)for(let b of a.headlines)d.push({topic:a.query,title:b.title,source:b.source,url:b.url,snippet:b.snippet});return d.slice(0,7)}async function cs(a,b){let c=a.name.split(" ")[0];if(0===b.length)return`${c}, no significant news today for your tracked topics. Check back tomorrow!`;let d=b.slice(0,3).map(a=>`- ${a.topic}: ${a.title}`).join("\n"),e=`Write a brief morning briefing for ${c}.

Top news:
${d}

Style:
- Open with a hook about the biggest story
- Be conversational, like texting a friend
- Under 200 characters
- 1-2 relevant emojis

Return ONLY the message text.`,f=(await cp.messages.create({model:"claude-sonnet-4-20250514",max_tokens:200,messages:[{role:"user",content:e}]})).content.find(a=>"text"===a.type);return f&&"text"===f.type?f.text.trim():`${c}, here's your daily briefing with ${b.length} updates.`}async function ct(a,b,c){let d=b+"\n\n"+c.slice(0,3).map(a=>a.url?`${a.title}
${a.url}`:a.title).join("\n\n");switch(console.log(`Delivering to ${a.name} via ${a.deliveryMethod}`),console.log(`Message: ${d.substring(0,100)}...`),a.deliveryMethod){case"email":return console.log(`Would send email to ${a.email}`),{success:!0};case"webhook":if(a.webhookUrl)try{return{success:(await fetch(a.webhookUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"daily_briefing",subscription_id:a.id,message:d,news_items:c,timestamp:new Date().toISOString()})})).ok}}catch(a){return{success:!1,error:String(a)}}return{success:!1,error:"No webhook URL"};case"imessage":case"sms":return console.log(`Would send ${a.deliveryMethod} to ${a.phone}`),console.log(`Message: ${d}`),{success:!0};default:return{success:!1,error:"Unknown delivery method"}}}async function cu(a){let b=a.headers.get("authorization");if(process.env.CRON_SECRET&&b!==`Bearer ${process.env.CRON_SECRET}`)return aJ.NextResponse.json({error:"Unauthorized"},{status:401});let c=[];try{let a=await (0,cm.Wn)();for(let b of(console.log(`Found ${a.length} active subscriptions`),a)){if(!function(a){let b=new Date,c=b.getDay();if(!a.schedule.daysOfWeek.includes(c))return!1;let[d,e]=a.schedule.time.split(":").map(Number),f=new Intl.DateTimeFormat("en-US",{timeZone:a.schedule.timezone,hour:"numeric",minute:"numeric",hour12:!1}).formatToParts(b),g=parseInt(f.find(a=>"hour"===a.type)?.value||"0"),h=parseInt(f.find(a=>"minute"===a.type)?.value||"0"),i=60*d+e,j=60*g+h;return j>=i&&j<i+15}(b)){c.push({subscriptionId:b.id,name:b.name,status:"skipped",reason:"Not scheduled for this time"});continue}if(b.lastDeliveredAt){let a=new Date(b.lastDeliveredAt),d=new Date;if(a.toDateString()===d.toDateString()){c.push({subscriptionId:b.id,name:b.name,status:"skipped",reason:"Already delivered today"});continue}}try{let a=await cr(b),d=await cs(b,a),e=await ct(b,d,a);await (0,cm.gn)(b.id,d,a.map(a=>({headline:a.title,source:a.source,url:a.url||"",company:a.topic})),e.success?"sent":"failed",e.error),e.success&&await (0,cm.LJ)(b.id,{lastDeliveredAt:new Date}),c.push({subscriptionId:b.id,name:b.name,status:e.success?"delivered":"failed",reason:e.error})}catch(a){console.error(`Error processing ${b.name}:`,a),c.push({subscriptionId:b.id,name:b.name,status:"failed",reason:String(a)})}}return aJ.NextResponse.json({success:!0,processed:c.length,delivered:c.filter(a=>"delivered"===a.status).length,skipped:c.filter(a=>"skipped"===a.status).length,failed:c.filter(a=>"failed"===a.status).length,results:c})}catch(a){return console.error("Cron job error:",a),aJ.NextResponse.json({error:"Failed to process briefings",details:String(a)},{status:500})}}let cv=new at.AppRouteRouteModule({definition:{kind:au.RouteKind.APP_ROUTE,page:"/api/cron/briefings/route",pathname:"/api/cron/briefings",filename:"route",bundlePath:"app/api/cron/briefings/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"/Users/marioelysian/imessage-mino-bot/snap-apps-server/src/app/api/cron/briefings/route.ts",nextConfigOutput:"",userland:as}),{workAsyncStorage:cw,workUnitAsyncStorage:cx,serverHooks:cy}=cv;function cz(){return(0,av.patchFetch)({workAsyncStorage:cw,workUnitAsyncStorage:cx})}async function cA(a,b,c){var d;let e="/api/cron/briefings/route";"/index"===e&&(e="/");let f=await cv.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!f)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:g,params:h,nextConfig:i,isDraftMode:j,prerenderManifest:k,routerServerContext:l,isOnDemandRevalidate:m,revalidateOnlyGenerated:n,resolvedPathname:o}=f,p=(0,ay.normalizeAppPath)(e),q=!!(k.dynamicRoutes[p]||k.routes[o]);if(q&&!j){let a=!!k.routes[o],b=k.dynamicRoutes[p];if(b&&!1===b.fallback&&!a)throw new aH.NoFallbackError}let r=null;!q||cv.isDev||j||(r="/index"===(r=o)?"/":r);let s=!0===cv.isDev||!q,t=q&&!s,u=a.method||"GET",v=(0,ax.getTracer)(),w=v.getActiveScopeSpan(),x={params:h,prerenderManifest:k,renderOpts:{experimental:{cacheComponents:!!i.experimental.cacheComponents,authInterrupts:!!i.experimental.authInterrupts},supportsDynamicResponse:s,incrementalCache:(0,aw.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=i.experimental)?void 0:d.cacheLife,isRevalidate:t,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>cv.onRequestError(a,b,d,l)},sharedContext:{buildId:g}},y=new az.NodeNextRequest(a),z=new az.NodeNextResponse(b),A=aA.NextRequestAdapter.fromNodeNextRequest(y,(0,aA.signalFromNodeResponse)(b));try{let d=async c=>cv.handle(A,x).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=v.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==aB.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${u} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${u} ${a.url}`)}),f=async f=>{var g,h;let o=async({previousCacheEntry:g})=>{try{if(!(0,aw.getRequestMeta)(a,"minimalMode")&&m&&n&&!g)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(f);a.fetchMetrics=x.renderOpts.fetchMetrics;let h=x.renderOpts.pendingWaitUntil;h&&c.waitUntil&&(c.waitUntil(h),h=void 0);let i=x.renderOpts.collectedTags;if(!q)return await (0,aD.I)(y,z,e,x.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,aE.toNodeOutgoingHttpHeaders)(e.headers);i&&(b[aG.NEXT_CACHE_TAGS_HEADER]=i),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==x.renderOpts.collectedRevalidate&&!(x.renderOpts.collectedRevalidate>=aG.INFINITE_CACHE)&&x.renderOpts.collectedRevalidate,d=void 0===x.renderOpts.collectedExpire||x.renderOpts.collectedExpire>=aG.INFINITE_CACHE?void 0:x.renderOpts.collectedExpire;return{value:{kind:aI.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==g?void 0:g.isStale)&&await cv.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,aC.c)({isRevalidate:t,isOnDemandRevalidate:m})},l),b}},p=await cv.handleResponse({req:a,nextConfig:i,cacheKey:r,routeKind:au.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:k,isRoutePPREnabled:!1,isOnDemandRevalidate:m,revalidateOnlyGenerated:n,responseGenerator:o,waitUntil:c.waitUntil});if(!q)return null;if((null==p||null==(g=p.value)?void 0:g.kind)!==aI.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(h=p.value)?void 0:h.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,aw.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",m?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),j&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let s=(0,aE.fromNodeOutgoingHttpHeaders)(p.value.headers);return(0,aw.getRequestMeta)(a,"minimalMode")&&q||s.delete(aG.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||b.getHeader("Cache-Control")||s.get("Cache-Control")||s.set("Cache-Control",(0,aF.getCacheControlHeader)(p.cacheControl)),await (0,aD.I)(y,z,new Response(p.value.body,{headers:s,status:p.value.status||200})),null};w?await f(w):await v.withPropagatedContext(a.headers,()=>v.trace(aB.BaseServerSpan.handleRequest,{spanName:`${u} ${a.url}`,kind:ax.SpanKind.SERVER,attributes:{"http.method":u,"http.target":a.url}},f))}catch(b){if(b instanceof aH.NoFallbackError||await cv.onRequestError(a,b,{routerKind:"App Router",routePath:p,routeType:"route",revalidateReason:(0,aC.c)({isRevalidate:t,isOnDemandRevalidate:m})}),q)throw b;return await (0,aD.I)(y,z,new Response(null,{status:500})),null}}},96487:()=>{}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[586,692,762,461],()=>b(b.s=89789));module.exports=c})();