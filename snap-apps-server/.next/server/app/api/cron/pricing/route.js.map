{"version":3,"file":"app/api/cron/pricing/route.js","mappings":"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","sources":["webpack://_N_E/external commonjs \"node:buffer\"","webpack://_N_E/external commonjs \"node:async_hooks\"","webpack://_N_E/","webpack://_N_E/./src/lib/scrapers/saas-pricing.ts","webpack://_N_E/./src/lib/notifications.ts","webpack://_N_E/./src/app/api/cron/pricing/route.ts","webpack://_N_E/./src/app/api/cron/pricing/route.ts?522f","webpack://_N_E/?f49d","webpack://_N_E/?3507"],"sourcesContent":["module.exports = require(\"node:buffer\");","module.exports = require(\"node:async_hooks\");",null,"/**\n * SaaS Pricing Scraper\n *\n * Extracts pricing information from SaaS pricing pages.\n * Designed to work with common pricing page patterns.\n */\n\nimport { z } from \"zod\";\n\n// ============================================================================\n// TYPES\n// ============================================================================\n\nexport const PricingTierSchema = z.object({\n  name: z.string(),\n  price: z.number().nullable(), // null for \"Contact Sales\" or custom pricing\n  period: z.enum([\"monthly\", \"yearly\", \"one-time\", \"custom\"]).default(\"monthly\"),\n  currency: z.string().default(\"USD\"),\n  features: z.array(z.string()),\n  highlighted: z.boolean().default(false), // \"Popular\" or featured tier\n  cta: z.string().optional(), // Call to action text\n});\n\nexport const SaaSPricingSchema = z.object({\n  companyName: z.string(),\n  url: z.string().url(),\n  tiers: z.array(PricingTierSchema),\n  hasFreeTier: z.boolean(),\n  hasEnterprise: z.boolean(),\n  lastUpdated: z.string(),\n  rawHtml: z.string().optional(), // For debugging\n});\n\nexport type PricingTier = z.infer<typeof PricingTierSchema>;\nexport type SaaSPricing = z.infer<typeof SaaSPricingSchema>;\n\n// ============================================================================\n// KNOWN SAAS PRICING PAGES\n// ============================================================================\n\nexport const SAAS_PRICING_DATABASE: { name: string; url: string; category: string }[] = [\n  // AI & ML\n  { name: \"OpenAI\", url: \"https://openai.com/pricing\", category: \"AI\" },\n  { name: \"Anthropic\", url: \"https://www.anthropic.com/pricing\", category: \"AI\" },\n  { name: \"Cohere\", url: \"https://cohere.com/pricing\", category: \"AI\" },\n  { name: \"Replicate\", url: \"https://replicate.com/pricing\", category: \"AI\" },\n  { name: \"Hugging Face\", url: \"https://huggingface.co/pricing\", category: \"AI\" },\n\n  // Developer Tools\n  { name: \"GitHub\", url: \"https://github.com/pricing\", category: \"Dev Tools\" },\n  { name: \"GitLab\", url: \"https://about.gitlab.com/pricing/\", category: \"Dev Tools\" },\n  { name: \"Vercel\", url: \"https://vercel.com/pricing\", category: \"Dev Tools\" },\n  { name: \"Netlify\", url: \"https://www.netlify.com/pricing/\", category: \"Dev Tools\" },\n  { name: \"Railway\", url: \"https://railway.app/pricing\", category: \"Dev Tools\" },\n  { name: \"Render\", url: \"https://render.com/pricing\", category: \"Dev Tools\" },\n  { name: \"Fly.io\", url: \"https://fly.io/pricing/\", category: \"Dev Tools\" },\n\n  // Productivity\n  { name: \"Notion\", url: \"https://www.notion.so/pricing\", category: \"Productivity\" },\n  { name: \"Linear\", url: \"https://linear.app/pricing\", category: \"Productivity\" },\n  { name: \"Slack\", url: \"https://slack.com/pricing\", category: \"Productivity\" },\n  { name: \"Figma\", url: \"https://www.figma.com/pricing/\", category: \"Productivity\" },\n\n  // Analytics & Monitoring\n  { name: \"Posthog\", url: \"https://posthog.com/pricing\", category: \"Analytics\" },\n  { name: \"Amplitude\", url: \"https://amplitude.com/pricing\", category: \"Analytics\" },\n  { name: \"Mixpanel\", url: \"https://mixpanel.com/pricing/\", category: \"Analytics\" },\n  { name: \"Datadog\", url: \"https://www.datadoghq.com/pricing/\", category: \"Monitoring\" },\n  { name: \"Sentry\", url: \"https://sentry.io/pricing/\", category: \"Monitoring\" },\n\n  // Database & Backend\n  { name: \"Supabase\", url: \"https://supabase.com/pricing\", category: \"Database\" },\n  { name: \"PlanetScale\", url: \"https://planetscale.com/pricing\", category: \"Database\" },\n  { name: \"Neon\", url: \"https://neon.tech/pricing\", category: \"Database\" },\n  { name: \"Firebase\", url: \"https://firebase.google.com/pricing\", category: \"Database\" },\n  { name: \"Upstash\", url: \"https://upstash.com/pricing\", category: \"Database\" },\n\n  // Auth\n  { name: \"Auth0\", url: \"https://auth0.com/pricing\", category: \"Auth\" },\n  { name: \"Clerk\", url: \"https://clerk.com/pricing\", category: \"Auth\" },\n\n  // Email & Communication\n  { name: \"Resend\", url: \"https://resend.com/pricing\", category: \"Email\" },\n  { name: \"Postmark\", url: \"https://postmarkapp.com/pricing\", category: \"Email\" },\n  { name: \"SendGrid\", url: \"https://sendgrid.com/en-us/pricing\", category: \"Email\" },\n  { name: \"Twilio\", url: \"https://www.twilio.com/en-us/pricing\", category: \"Communication\" },\n\n  // CMS & Content\n  { name: \"Sanity\", url: \"https://www.sanity.io/pricing\", category: \"CMS\" },\n  { name: \"Contentful\", url: \"https://www.contentful.com/pricing/\", category: \"CMS\" },\n\n  // Our reference\n  { name: \"Mino\", url: \"https://billing.mino.ai/\", category: \"AI\" },\n];\n\n// ============================================================================\n// PRICE EXTRACTION HELPERS\n// ============================================================================\n\n/**\n * Extract price from common formats:\n * - \"$10/mo\", \"$10 / month\", \"$10/month\"\n * - \"$120/year\", \"$120 annually\"\n * - \"Free\", \"$0\"\n * - \"Contact Sales\", \"Custom\"\n */\nexport function extractPrice(text: string): { price: number | null; period: PricingTier[\"period\"] } {\n  const normalized = text.toLowerCase().trim();\n\n  // Free tier\n  if (normalized === \"free\" || normalized === \"$0\" || normalized === \"0\") {\n    return { price: 0, period: \"monthly\" };\n  }\n\n  // Contact sales / Custom\n  if (\n    normalized.includes(\"contact\") ||\n    normalized.includes(\"custom\") ||\n    normalized.includes(\"enterprise\") ||\n    normalized.includes(\"talk to\")\n  ) {\n    return { price: null, period: \"custom\" };\n  }\n\n  // Extract numeric price\n  const priceMatch = text.match(/\\$?([\\d,]+(?:\\.\\d{2})?)/);\n  if (!priceMatch) {\n    return { price: null, period: \"custom\" };\n  }\n\n  const price = parseFloat(priceMatch[1].replace(\",\", \"\"));\n\n  // Determine period\n  let period: PricingTier[\"period\"] = \"monthly\";\n  if (normalized.includes(\"year\") || normalized.includes(\"annual\") || normalized.includes(\"/yr\")) {\n    period = \"yearly\";\n  } else if (normalized.includes(\"one-time\") || normalized.includes(\"once\")) {\n    period = \"one-time\";\n  }\n\n  return { price, period };\n}\n\n/**\n * Normalize yearly price to monthly for comparison\n */\nexport function normalizeToMonthly(price: number | null, period: PricingTier[\"period\"]): number | null {\n  if (price === null) return null;\n  if (period === \"yearly\") return price / 12;\n  return price;\n}\n\n// ============================================================================\n// PRICING ANALYSIS\n// ============================================================================\n\nexport interface PricingComparison {\n  company: string;\n  tier: string;\n  monthlyPrice: number | null;\n  vsMinoPercent: number | null; // Positive = more expensive, negative = cheaper\n  features: string[];\n}\n\n/**\n * Compare extracted pricing against Mino's pricing\n */\nexport function comparePricing(\n  allPricing: SaaSPricing[],\n  minoPricing: SaaSPricing\n): PricingComparison[] {\n  const comparisons: PricingComparison[] = [];\n\n  // Get Mino's comparable tier (usually \"Pro\" or middle tier)\n  const minoProTier = minoPricing.tiers.find(\n    t => t.name.toLowerCase().includes(\"pro\") ||\n         t.name.toLowerCase().includes(\"standard\") ||\n         (!t.name.toLowerCase().includes(\"free\") && !t.name.toLowerCase().includes(\"enterprise\"))\n  ) || minoPricing.tiers[1]; // Fallback to second tier\n\n  const minoMonthly = minoProTier\n    ? normalizeToMonthly(minoProTier.price, minoProTier.period)\n    : null;\n\n  for (const pricing of allPricing) {\n    if (pricing.companyName === \"Mino\") continue;\n\n    for (const tier of pricing.tiers) {\n      const monthlyPrice = normalizeToMonthly(tier.price, tier.period);\n\n      let vsMinoPercent: number | null = null;\n      if (monthlyPrice !== null && minoMonthly !== null && minoMonthly > 0) {\n        vsMinoPercent = ((monthlyPrice - minoMonthly) / minoMonthly) * 100;\n      }\n\n      comparisons.push({\n        company: pricing.companyName,\n        tier: tier.name,\n        monthlyPrice,\n        vsMinoPercent,\n        features: tier.features.slice(0, 5), // Top 5 features\n      });\n    }\n  }\n\n  return comparisons.sort((a, b) => {\n    if (a.monthlyPrice === null) return 1;\n    if (b.monthlyPrice === null) return -1;\n    return a.monthlyPrice - b.monthlyPrice;\n  });\n}\n\n// ============================================================================\n// SCRAPE ORCHESTRATION\n// ============================================================================\n\nexport interface ScrapedPricing {\n  success: boolean;\n  data?: SaaSPricing;\n  error?: string;\n  rawResponse?: string;\n}\n\n/**\n * Scrape pricing from a URL using an AI extraction approach\n * This is a placeholder - in production, use Firecrawl, Browserless, or similar\n */\nexport async function scrapePricingPage(\n  url: string,\n  companyName: string\n): Promise<ScrapedPricing> {\n  try {\n    // In production, use a proper scraping service\n    // For now, we'll use a simple fetch + regex approach\n    const response = await fetch(url, {\n      headers: {\n        \"User-Agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36\",\n        \"Accept\": \"text/html,application/xhtml+xml\",\n      },\n    });\n\n    if (!response.ok) {\n      return {\n        success: false,\n        error: `HTTP ${response.status}: ${response.statusText}`\n      };\n    }\n\n    const html = await response.text();\n\n    // Very basic extraction - real implementation would use AI or DOM parsing\n    const tiers: PricingTier[] = [];\n\n    // Look for common pricing patterns\n    const pricePatterns = [\n      /\\$(\\d+(?:\\.\\d{2})?)\\s*\\/?\\s*(mo(?:nth)?|yr|year|annually)?/gi,\n      /(\\d+(?:\\.\\d{2})?)\\s*USD\\s*\\/?\\s*(mo(?:nth)?|yr|year)?/gi,\n    ];\n\n    const prices: string[] = [];\n    for (const pattern of pricePatterns) {\n      const matches = html.matchAll(pattern);\n      for (const match of matches) {\n        prices.push(match[0]);\n      }\n    }\n\n    // Dedupe and create tiers\n    const uniquePrices = [...new Set(prices)].slice(0, 4);\n    for (let i = 0; i < uniquePrices.length; i++) {\n      const { price, period } = extractPrice(uniquePrices[i]);\n      tiers.push({\n        name: `Tier ${i + 1}`,\n        price,\n        period,\n        currency: \"USD\",\n        features: [],\n        highlighted: i === 1, // Middle tier often highlighted\n      });\n    }\n\n    // Determine has free tier\n    const hasFreeTier = tiers.some(t => t.price === 0) ||\n                        html.toLowerCase().includes(\"free tier\") ||\n                        html.toLowerCase().includes(\"free plan\");\n\n    // Determine has enterprise\n    const hasEnterprise = html.toLowerCase().includes(\"enterprise\") ||\n                          html.toLowerCase().includes(\"contact sales\");\n\n    const data: SaaSPricing = {\n      companyName,\n      url,\n      tiers,\n      hasFreeTier,\n      hasEnterprise,\n      lastUpdated: new Date().toISOString(),\n    };\n\n    return { success: true, data };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : \"Unknown error\",\n    };\n  }\n}\n\n/**\n * Scrape all known SaaS pricing pages\n */\nexport async function scrapeAllPricingPages(): Promise<Map<string, ScrapedPricing>> {\n  const results = new Map<string, ScrapedPricing>();\n\n  // Process in batches to avoid rate limiting\n  const batchSize = 5;\n  for (let i = 0; i < SAAS_PRICING_DATABASE.length; i += batchSize) {\n    const batch = SAAS_PRICING_DATABASE.slice(i, i + batchSize);\n\n    const batchResults = await Promise.all(\n      batch.map(({ name, url }) => scrapePricingPage(url, name))\n    );\n\n    for (let j = 0; j < batch.length; j++) {\n      results.set(batch[j].name, batchResults[j]);\n    }\n\n    // Small delay between batches\n    if (i + batchSize < SAAS_PRICING_DATABASE.length) {\n      await new Promise(r => setTimeout(r, 1000));\n    }\n  }\n\n  return results;\n}\n","/**\n * Notification System for Snap Apps\n *\n * Supports:\n * - Push notifications (APNs for iOS)\n * - SMS/Text notifications (Twilio)\n * - Webhook callbacks\n *\n * Used for:\n * - Price change alerts\n * - Availability notifications\n * - Data refresh alerts\n */\n\nimport { kv } from \"@vercel/kv\";\n\n// ============================================================================\n// TYPES\n// ============================================================================\n\nexport type NotificationChannel = \"push\" | \"sms\" | \"webhook\" | \"imessage\";\n\nexport interface NotificationPreferences {\n  userId: string;\n  channels: NotificationChannel[];\n  apnsToken?: string; // iOS push token\n  phoneNumber?: string; // For SMS\n  webhookUrl?: string;\n  imessageHandle?: string; // Phone or email for iMessage\n}\n\nexport interface NotificationPayload {\n  title: string;\n  body: string;\n  data?: Record<string, unknown>;\n  snapAppId?: string;\n  priority?: \"high\" | \"normal\" | \"low\";\n}\n\nexport interface DiffAlert {\n  id: string;\n  snapAppId: string;\n  field: string; // JSON path to monitor, e.g., \"data.items[0].price\"\n  threshold?: number; // For numeric fields, % change to trigger\n  condition?: \"any_change\" | \"increase\" | \"decrease\" | \"threshold\";\n  lastValue: unknown;\n  createdAt: string;\n  lastTriggeredAt?: string;\n}\n\n// ============================================================================\n// NOTIFICATION PREFERENCES\n// ============================================================================\n\nexport async function setNotificationPreferences(\n  prefs: NotificationPreferences\n): Promise<void> {\n  await kv.set(`notif:prefs:${prefs.userId}`, prefs);\n}\n\nexport async function getNotificationPreferences(\n  userId: string\n): Promise<NotificationPreferences | null> {\n  return kv.get<NotificationPreferences>(`notif:prefs:${userId}`);\n}\n\n// ============================================================================\n// PUSH NOTIFICATIONS (APNs)\n// ============================================================================\n\nconst APNS_KEY_ID = process.env.APNS_KEY_ID;\nconst APNS_TEAM_ID = process.env.APNS_TEAM_ID;\nconst APNS_BUNDLE_ID = process.env.APNS_BUNDLE_ID || \"com.minnow.mino\";\nconst APNS_PRIVATE_KEY = process.env.APNS_PRIVATE_KEY;\n\nasync function sendPushNotification(\n  deviceToken: string,\n  payload: NotificationPayload\n): Promise<boolean> {\n  if (!APNS_KEY_ID || !APNS_TEAM_ID || !APNS_PRIVATE_KEY) {\n    console.warn(\"APNs not configured, skipping push notification\");\n    return false;\n  }\n\n  try {\n    // Generate JWT for APNs\n    const jwt = await generateApnsJwt();\n\n    const apnsPayload = {\n      aps: {\n        alert: {\n          title: payload.title,\n          body: payload.body,\n        },\n        sound: \"default\",\n        badge: 1,\n        \"mutable-content\": 1,\n      },\n      snapAppId: payload.snapAppId,\n      ...payload.data,\n    };\n\n    const isProduction = process.env.NODE_ENV === \"production\";\n    const apnsHost = isProduction\n      ? \"api.push.apple.com\"\n      : \"api.sandbox.push.apple.com\";\n\n    const response = await fetch(\n      `https://${apnsHost}/3/device/${deviceToken}`,\n      {\n        method: \"POST\",\n        headers: {\n          Authorization: `bearer ${jwt}`,\n          \"apns-topic\": APNS_BUNDLE_ID!,\n          \"apns-push-type\": \"alert\",\n          \"apns-priority\": payload.priority === \"high\" ? \"10\" : \"5\",\n        },\n        body: JSON.stringify(apnsPayload),\n      }\n    );\n\n    if (!response.ok) {\n      const error = await response.text();\n      console.error(\"APNs error:\", error);\n      return false;\n    }\n\n    return true;\n  } catch (error) {\n    console.error(\"Push notification failed:\", error);\n    return false;\n  }\n}\n\nasync function generateApnsJwt(): Promise<string> {\n  // In production, use proper JWT library with ES256 signing\n  // This is a placeholder - implement with jose or similar\n  const header = btoa(JSON.stringify({ alg: \"ES256\", kid: APNS_KEY_ID }));\n  const now = Math.floor(Date.now() / 1000);\n  const claims = btoa(\n    JSON.stringify({ iss: APNS_TEAM_ID, iat: now })\n  );\n\n  // TODO: Sign with APNS_PRIVATE_KEY using ES256\n  // For now, return placeholder\n  return `${header}.${claims}.signature`;\n}\n\n// ============================================================================\n// SMS NOTIFICATIONS (Twilio)\n// ============================================================================\n\nconst TWILIO_ACCOUNT_SID = process.env.TWILIO_ACCOUNT_SID;\nconst TWILIO_AUTH_TOKEN = process.env.TWILIO_AUTH_TOKEN;\nconst TWILIO_PHONE_NUMBER = process.env.TWILIO_PHONE_NUMBER;\n\nasync function sendSmsNotification(\n  phoneNumber: string,\n  payload: NotificationPayload\n): Promise<boolean> {\n  if (!TWILIO_ACCOUNT_SID || !TWILIO_AUTH_TOKEN || !TWILIO_PHONE_NUMBER) {\n    console.warn(\"Twilio not configured, skipping SMS notification\");\n    return false;\n  }\n\n  try {\n    const message = `${payload.title}\\n\\n${payload.body}`;\n\n    const response = await fetch(\n      `https://api.twilio.com/2010-04-01/Accounts/${TWILIO_ACCOUNT_SID}/Messages.json`,\n      {\n        method: \"POST\",\n        headers: {\n          Authorization: `Basic ${btoa(`${TWILIO_ACCOUNT_SID}:${TWILIO_AUTH_TOKEN}`)}`,\n          \"Content-Type\": \"application/x-www-form-urlencoded\",\n        },\n        body: new URLSearchParams({\n          To: phoneNumber,\n          From: TWILIO_PHONE_NUMBER,\n          Body: message,\n        }),\n      }\n    );\n\n    if (!response.ok) {\n      const error = await response.json();\n      console.error(\"Twilio error:\", error);\n      return false;\n    }\n\n    return true;\n  } catch (error) {\n    console.error(\"SMS notification failed:\", error);\n    return false;\n  }\n}\n\n// ============================================================================\n// iMESSAGE NOTIFICATIONS (via bot)\n// ============================================================================\n\nconst IMESSAGE_BOT_WEBHOOK = process.env.IMESSAGE_BOT_WEBHOOK;\n\nasync function sendIMessageNotification(\n  handle: string,\n  payload: NotificationPayload\n): Promise<boolean> {\n  if (!IMESSAGE_BOT_WEBHOOK) {\n    console.warn(\"iMessage bot webhook not configured\");\n    return false;\n  }\n\n  try {\n    const message = `ðŸ”” ${payload.title}\\n\\n${payload.body}`;\n\n    const response = await fetch(IMESSAGE_BOT_WEBHOOK, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        recipient: handle,\n        message,\n        snapAppId: payload.snapAppId,\n      }),\n    });\n\n    return response.ok;\n  } catch (error) {\n    console.error(\"iMessage notification failed:\", error);\n    return false;\n  }\n}\n\n// ============================================================================\n// WEBHOOK NOTIFICATIONS\n// ============================================================================\n\nasync function sendWebhookNotification(\n  webhookUrl: string,\n  payload: NotificationPayload\n): Promise<boolean> {\n  try {\n    const response = await fetch(webhookUrl, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"X-Mino-Notification\": \"true\",\n      },\n      body: JSON.stringify(payload),\n    });\n\n    return response.ok;\n  } catch (error) {\n    console.error(\"Webhook notification failed:\", error);\n    return false;\n  }\n}\n\n// ============================================================================\n// SEND NOTIFICATION (MULTI-CHANNEL)\n// ============================================================================\n\nexport async function sendNotification(\n  userId: string,\n  payload: NotificationPayload\n): Promise<{ success: boolean; channels: NotificationChannel[] }> {\n  const prefs = await getNotificationPreferences(userId);\n\n  if (!prefs) {\n    return { success: false, channels: [] };\n  }\n\n  const sentChannels: NotificationChannel[] = [];\n\n  for (const channel of prefs.channels) {\n    let sent = false;\n\n    switch (channel) {\n      case \"push\":\n        if (prefs.apnsToken) {\n          sent = await sendPushNotification(prefs.apnsToken, payload);\n        }\n        break;\n\n      case \"sms\":\n        if (prefs.phoneNumber) {\n          sent = await sendSmsNotification(prefs.phoneNumber, payload);\n        }\n        break;\n\n      case \"imessage\":\n        if (prefs.imessageHandle) {\n          sent = await sendIMessageNotification(prefs.imessageHandle, payload);\n        }\n        break;\n\n      case \"webhook\":\n        if (prefs.webhookUrl) {\n          sent = await sendWebhookNotification(prefs.webhookUrl, payload);\n        }\n        break;\n    }\n\n    if (sent) {\n      sentChannels.push(channel);\n    }\n  }\n\n  return {\n    success: sentChannels.length > 0,\n    channels: sentChannels,\n  };\n}\n\n// ============================================================================\n// DIFF ALERTS\n// ============================================================================\n\nexport async function createDiffAlert(\n  alert: Omit<DiffAlert, \"id\" | \"createdAt\">\n): Promise<DiffAlert> {\n  const id = `alert_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n\n  const fullAlert: DiffAlert = {\n    ...alert,\n    id,\n    createdAt: new Date().toISOString(),\n  };\n\n  await kv.set(`alert:${id}`, fullAlert);\n  await kv.sadd(`alerts:snapapp:${alert.snapAppId}`, id);\n\n  return fullAlert;\n}\n\nexport async function getDiffAlertsForSnapApp(\n  snapAppId: string\n): Promise<DiffAlert[]> {\n  const alertIds = await kv.smembers(`alerts:snapapp:${snapAppId}`);\n  const alerts = await Promise.all(\n    alertIds.map((id) => kv.get<DiffAlert>(`alert:${id}`))\n  );\n  return alerts.filter((a): a is DiffAlert => a !== null);\n}\n\nexport async function deleteDiffAlert(alertId: string): Promise<void> {\n  const alert = await kv.get<DiffAlert>(`alert:${alertId}`);\n  if (alert) {\n    await kv.srem(`alerts:snapapp:${alert.snapAppId}`, alertId);\n    await kv.del(`alert:${alertId}`);\n  }\n}\n\n// ============================================================================\n// DIFF DETECTION\n// ============================================================================\n\n/**\n * Get value at JSON path\n * Supports: \"field\", \"field.nested\", \"field[0]\", \"field[0].nested\"\n */\nfunction getValueAtPath(obj: unknown, path: string): unknown {\n  const parts = path.split(/\\.|\\[|\\]/).filter(Boolean);\n  let current: unknown = obj;\n\n  for (const part of parts) {\n    if (current === null || current === undefined) return undefined;\n    if (typeof current !== \"object\") return undefined;\n\n    const key = /^\\d+$/.test(part) ? parseInt(part) : part;\n    current = (current as Record<string, unknown>)[key as string];\n  }\n\n  return current;\n}\n\n/**\n * Check if a diff alert should trigger\n */\nexport function shouldTriggerAlert(\n  alert: DiffAlert,\n  newValue: unknown\n): boolean {\n  const { lastValue, condition, threshold } = alert;\n\n  // Any change\n  if (condition === \"any_change\") {\n    return JSON.stringify(newValue) !== JSON.stringify(lastValue);\n  }\n\n  // Numeric comparisons\n  if (typeof newValue === \"number\" && typeof lastValue === \"number\") {\n    const percentChange = ((newValue - lastValue) / lastValue) * 100;\n\n    switch (condition) {\n      case \"increase\":\n        return newValue > lastValue;\n\n      case \"decrease\":\n        return newValue < lastValue;\n\n      case \"threshold\":\n        return threshold !== undefined && Math.abs(percentChange) >= threshold;\n    }\n  }\n\n  // Default: any change\n  return JSON.stringify(newValue) !== JSON.stringify(lastValue);\n}\n\n/**\n * Process diff alerts for a Snap App after data update\n */\nexport async function processDiffAlerts(\n  snapAppId: string,\n  oldData: Record<string, unknown>,\n  newData: Record<string, unknown>,\n  userId?: string\n): Promise<DiffAlert[]> {\n  const alerts = await getDiffAlertsForSnapApp(snapAppId);\n  const triggeredAlerts: DiffAlert[] = [];\n\n  for (const alert of alerts) {\n    const oldValue = getValueAtPath(oldData, alert.field);\n    const newValue = getValueAtPath(newData, alert.field);\n\n    if (shouldTriggerAlert({ ...alert, lastValue: oldValue }, newValue)) {\n      triggeredAlerts.push(alert);\n\n      // Update alert with new value and trigger time\n      await kv.set(`alert:${alert.id}`, {\n        ...alert,\n        lastValue: newValue,\n        lastTriggeredAt: new Date().toISOString(),\n      });\n\n      // Send notification if userId provided\n      if (userId) {\n        await sendNotification(userId, {\n          title: \"Price Change Alert\",\n          body: `${alert.field} changed from ${JSON.stringify(oldValue)} to ${JSON.stringify(newValue)}`,\n          snapAppId,\n          data: {\n            alertId: alert.id,\n            field: alert.field,\n            oldValue,\n            newValue,\n          },\n          priority: \"high\",\n        });\n      }\n    }\n  }\n\n  return triggeredAlerts;\n}\n","/**\n * Cron Pricing Refresh - Vercel Cron Job for scheduled SaaS pricing updates\n *\n * This endpoint is called by Vercel Cron to refresh all tracked pricing pages.\n * Schedule: Daily at 6 AM UTC (configure in vercel.json)\n *\n * GET /api/cron/pricing - Refresh all tracked pricing\n */\n\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { kv } from \"@vercel/kv\";\nimport {\n  SAAS_PRICING_DATABASE,\n  scrapePricingPage,\n  type SaaSPricing,\n} from \"@/lib/scrapers/saas-pricing\";\nimport { processDiffAlerts, sendNotification } from \"@/lib/notifications\";\n\ninterface TrackedPricing {\n  name: string;\n  url: string;\n  category: string;\n  pricing: SaaSPricing | null;\n  lastChecked: string;\n  lastChanged: string | null;\n  error?: string;\n}\n\ninterface ApiResponse<T> {\n  success: boolean;\n  data?: T;\n  error?: string;\n}\n\n// Verify cron secret to prevent unauthorized access\nconst CRON_SECRET = process.env.CRON_SECRET;\nconst KV_PREFIX = \"pricing:tracker\";\n\n// Who to notify about pricing changes (configure in env)\nconst PRICING_ALERT_USER_ID = process.env.PRICING_ALERT_USER_ID || \"admin\";\n\n// ============================================================================\n// GET - Refresh all pricing (called by Vercel Cron)\n// ============================================================================\n\nexport async function GET(request: NextRequest) {\n  try {\n    // Verify cron secret\n    const authHeader = request.headers.get(\"authorization\");\n\n    if (CRON_SECRET && authHeader !== `Bearer ${CRON_SECRET}`) {\n      const response: ApiResponse<null> = {\n        success: false,\n        error: \"Unauthorized\",\n      };\n      return NextResponse.json(response, { status: 401 });\n    }\n\n    const startTime = Date.now();\n    const results: {\n      name: string;\n      success: boolean;\n      changed: boolean;\n      priceChange?: { old: number | null; new: number | null };\n      error?: string;\n    }[] = [];\n\n    // Get existing tracked companies or use default database\n    let companies = await kv.smembers(`${KV_PREFIX}:companies`);\n\n    if (companies.length === 0) {\n      // Initialize with default database\n      for (const entry of SAAS_PRICING_DATABASE) {\n        await kv.sadd(`${KV_PREFIX}:companies`, entry.name);\n      }\n      companies = SAAS_PRICING_DATABASE.map((e) => e.name);\n    }\n\n    let changedCount = 0;\n\n    // Process each company\n    for (const companyName of companies) {\n      // Get current data\n      const current = await kv.get<TrackedPricing>(\n        `${KV_PREFIX}:${companyName}`\n      );\n\n      // Find URL (from current data or default database)\n      const dbEntry = SAAS_PRICING_DATABASE.find((e) => e.name === companyName);\n      const url = current?.url || dbEntry?.url;\n      const category = current?.category || dbEntry?.category || \"Other\";\n\n      if (!url) {\n        results.push({\n          name: companyName,\n          success: false,\n          changed: false,\n          error: \"No URL\",\n        });\n        continue;\n      }\n\n      // Scrape new data\n      const scraped = await scrapePricingPage(url, companyName);\n\n      let changed = false;\n      let priceChange:\n        | { old: number | null; new: number | null }\n        | undefined;\n\n      if (scraped.success && scraped.data) {\n        // Check for changes\n        if (current?.pricing) {\n          const oldPrices = JSON.stringify(current.pricing.tiers);\n          const newPrices = JSON.stringify(scraped.data.tiers);\n          changed = oldPrices !== newPrices;\n\n          // Track price changes for the first tier\n          if (changed) {\n            const oldFirstTier = current.pricing.tiers[0];\n            const newFirstTier = scraped.data.tiers[0];\n\n            priceChange = {\n              old: oldFirstTier?.price ?? null,\n              new: newFirstTier?.price ?? null,\n            };\n\n            changedCount++;\n\n            // Trigger diff alerts\n            await processDiffAlerts(\n              `pricing:${companyName}`,\n              { pricing: current.pricing },\n              { pricing: scraped.data },\n              PRICING_ALERT_USER_ID\n            );\n          }\n        } else {\n          changed = true; // First time\n        }\n      }\n\n      // Update stored data\n      const updated: TrackedPricing = {\n        name: companyName,\n        url,\n        category,\n        pricing: scraped.success ? scraped.data! : current?.pricing || null,\n        lastChecked: new Date().toISOString(),\n        lastChanged: changed\n          ? new Date().toISOString()\n          : current?.lastChanged || null,\n        error: scraped.success ? undefined : scraped.error,\n      };\n\n      await kv.set(`${KV_PREFIX}:${companyName}`, updated);\n\n      results.push({\n        name: companyName,\n        success: scraped.success,\n        changed,\n        priceChange,\n        error: scraped.error,\n      });\n\n      // Small delay to avoid rate limiting\n      await new Promise((r) => setTimeout(r, 500));\n    }\n\n    const duration = Date.now() - startTime;\n\n    // Send summary notification if there were changes\n    if (changedCount > 0) {\n      const changedCompanies = results\n        .filter((r) => r.changed)\n        .map((r) => r.name)\n        .join(\", \");\n\n      await sendNotification(PRICING_ALERT_USER_ID, {\n        title: \"SaaS Pricing Changes Detected\",\n        body: `${changedCount} pricing pages changed: ${changedCompanies}`,\n        data: {\n          changes: results.filter((r) => r.changed),\n        },\n        priority: \"high\",\n      });\n    }\n\n    // Summary\n    const summary = {\n      total: results.length,\n      successful: results.filter((r) => r.success).length,\n      failed: results.filter((r) => !r.success).length,\n      changed: changedCount,\n      durationMs: duration,\n    };\n\n    const response: ApiResponse<{\n      results: typeof results;\n      summary: typeof summary;\n      nextRun: string;\n    }> = {\n      success: true,\n      data: {\n        results,\n        summary,\n        nextRun: \"Tomorrow at 6:00 AM UTC\",\n      },\n    };\n\n    return NextResponse.json(response);\n  } catch (error) {\n    console.error(\"Pricing cron refresh failed:\", error);\n\n    const response: ApiResponse<null> = {\n      success: false,\n      error: \"Pricing refresh failed\",\n    };\n\n    return NextResponse.json(response, { status: 500 });\n  }\n}\n\n// ============================================================================\n// Vercel Cron Configuration\n// ============================================================================\n\nexport const runtime = \"edge\";\nexport const dynamic = \"force-dynamic\";\nexport const maxDuration = 300; // 5 minute timeout for processing all pages\n","import { AppRouteRouteModule } from \"next/dist/server/route-modules/app-route/module.compiled\";\nimport { RouteKind } from \"next/dist/server/route-kind\";\nimport { patchFetch as _patchFetch } from \"next/dist/server/lib/patch-fetch\";\nimport { getRequestMeta } from \"next/dist/server/request-meta\";\nimport { getTracer, SpanKind } from \"next/dist/server/lib/trace/tracer\";\nimport { normalizeAppPath } from \"next/dist/shared/lib/router/utils/app-paths\";\nimport { NodeNextRequest, NodeNextResponse } from \"next/dist/server/base-http/node\";\nimport { NextRequestAdapter, signalFromNodeResponse } from \"next/dist/server/web/spec-extension/adapters/next-request\";\nimport { BaseServerSpan } from \"next/dist/server/lib/trace/constants\";\nimport { getRevalidateReason } from \"next/dist/server/instrumentation/utils\";\nimport { sendResponse } from \"next/dist/server/send-response\";\nimport { fromNodeOutgoingHttpHeaders, toNodeOutgoingHttpHeaders } from \"next/dist/server/web/utils\";\nimport { getCacheControlHeader } from \"next/dist/server/lib/cache-control\";\nimport { INFINITE_CACHE, NEXT_CACHE_TAGS_HEADER } from \"next/dist/lib/constants\";\nimport { NoFallbackError } from \"next/dist/shared/lib/no-fallback-error.external\";\nimport { CachedRouteKind } from \"next/dist/server/response-cache\";\nimport * as userland from \"/Users/marioelysian/imessage-mino-bot/snap-apps-server/src/app/api/cron/pricing/route.ts\";\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new AppRouteRouteModule({\n    definition: {\n        kind: RouteKind.APP_ROUTE,\n        page: \"/api/cron/pricing/route\",\n        pathname: \"/api/cron/pricing\",\n        filename: \"route\",\n        bundlePath: \"app/api/cron/pricing/route\"\n    },\n    distDir: process.env.__NEXT_RELATIVE_DIST_DIR || '',\n    relativeProjectDir: process.env.__NEXT_RELATIVE_PROJECT_DIR || '',\n    resolvedPagePath: \"/Users/marioelysian/imessage-mino-bot/snap-apps-server/src/app/api/cron/pricing/route.ts\",\n    nextConfigOutput,\n    userland\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return _patchFetch({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\nexport { routeModule, workAsyncStorage, workUnitAsyncStorage, serverHooks, patchFetch,  };\nexport async function handler(req, res, ctx) {\n    var _nextConfig_experimental;\n    let srcPage = \"/api/cron/pricing/route\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (process.env.TURBOPACK) {\n        srcPage = srcPage.replace(/\\/index$/, '') || '/';\n    } else if (srcPage === '/index') {\n        // we always normalize /index specifically\n        srcPage = '/';\n    }\n    const multiZoneDraftMode = process.env.__NEXT_MULTI_ZONE_DRAFT_MODE;\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage,\n        multiZoneDraftMode\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return null;\n    }\n    const { buildId, params, nextConfig, isDraftMode, prerenderManifest, routerServerContext, isOnDemandRevalidate, revalidateOnlyGenerated, resolvedPathname } = prepareResult;\n    const normalizedSrcPage = normalizeAppPath(srcPage);\n    let isIsr = Boolean(prerenderManifest.dynamicRoutes[normalizedSrcPage] || prerenderManifest.routes[resolvedPathname]);\n    if (isIsr && !isDraftMode) {\n        const isPrerendered = Boolean(prerenderManifest.routes[resolvedPathname]);\n        const prerenderInfo = prerenderManifest.dynamicRoutes[normalizedSrcPage];\n        if (prerenderInfo) {\n            if (prerenderInfo.fallback === false && !isPrerendered) {\n                throw new NoFallbackError();\n            }\n        }\n    }\n    let cacheKey = null;\n    if (isIsr && !routeModule.isDev && !isDraftMode) {\n        cacheKey = resolvedPathname;\n        // ensure /index and / is normalized to one key\n        cacheKey = cacheKey === '/index' ? '/' : cacheKey;\n    }\n    const supportsDynamicResponse = // If we're in development, we always support dynamic HTML\n    routeModule.isDev === true || // If this is not SSG or does not have static paths, then it supports\n    // dynamic HTML.\n    !isIsr;\n    // This is a revalidation request if the request is for a static\n    // page and it is not being resumed from a postponed render and\n    // it is not a dynamic RSC request then it is a revalidation\n    // request.\n    const isRevalidate = isIsr && !supportsDynamicResponse;\n    const method = req.method || 'GET';\n    const tracer = getTracer();\n    const activeSpan = tracer.getActiveScopeSpan();\n    const context = {\n        params,\n        prerenderManifest,\n        renderOpts: {\n            experimental: {\n                cacheComponents: Boolean(nextConfig.experimental.cacheComponents),\n                authInterrupts: Boolean(nextConfig.experimental.authInterrupts)\n            },\n            supportsDynamicResponse,\n            incrementalCache: getRequestMeta(req, 'incrementalCache'),\n            cacheLifeProfiles: (_nextConfig_experimental = nextConfig.experimental) == null ? void 0 : _nextConfig_experimental.cacheLife,\n            isRevalidate,\n            waitUntil: ctx.waitUntil,\n            onClose: (cb)=>{\n                res.on('close', cb);\n            },\n            onAfterTaskError: undefined,\n            onInstrumentationRequestError: (error, _request, errorContext)=>routeModule.onRequestError(req, error, errorContext, routerServerContext)\n        },\n        sharedContext: {\n            buildId\n        }\n    };\n    const nodeNextReq = new NodeNextRequest(req);\n    const nodeNextRes = new NodeNextResponse(res);\n    const nextReq = NextRequestAdapter.fromNodeNextRequest(nodeNextReq, signalFromNodeResponse(res));\n    try {\n        const invokeRouteModule = async (span)=>{\n            return routeModule.handle(nextReq, context).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${req.url}`);\n                }\n            });\n        };\n        const handleResponse = async (currentSpan)=>{\n            var _cacheEntry_value;\n            const responseGenerator = async ({ previousCacheEntry })=>{\n                try {\n                    if (!getRequestMeta(req, 'minimalMode') && isOnDemandRevalidate && revalidateOnlyGenerated && !previousCacheEntry) {\n                        res.statusCode = 404;\n                        // on-demand revalidate always sets this header\n                        res.setHeader('x-nextjs-cache', 'REVALIDATED');\n                        res.end('This page could not be found');\n                        return null;\n                    }\n                    const response = await invokeRouteModule(currentSpan);\n                    req.fetchMetrics = context.renderOpts.fetchMetrics;\n                    let pendingWaitUntil = context.renderOpts.pendingWaitUntil;\n                    // Attempt using provided waitUntil if available\n                    // if it's not we fallback to sendResponse's handling\n                    if (pendingWaitUntil) {\n                        if (ctx.waitUntil) {\n                            ctx.waitUntil(pendingWaitUntil);\n                            pendingWaitUntil = undefined;\n                        }\n                    }\n                    const cacheTags = context.renderOpts.collectedTags;\n                    // If the request is for a static response, we can cache it so long\n                    // as it's not edge.\n                    if (isIsr) {\n                        const blob = await response.blob();\n                        // Copy the headers from the response.\n                        const headers = toNodeOutgoingHttpHeaders(response.headers);\n                        if (cacheTags) {\n                            headers[NEXT_CACHE_TAGS_HEADER] = cacheTags;\n                        }\n                        if (!headers['content-type'] && blob.type) {\n                            headers['content-type'] = blob.type;\n                        }\n                        const revalidate = typeof context.renderOpts.collectedRevalidate === 'undefined' || context.renderOpts.collectedRevalidate >= INFINITE_CACHE ? false : context.renderOpts.collectedRevalidate;\n                        const expire = typeof context.renderOpts.collectedExpire === 'undefined' || context.renderOpts.collectedExpire >= INFINITE_CACHE ? undefined : context.renderOpts.collectedExpire;\n                        // Create the cache entry for the response.\n                        const cacheEntry = {\n                            value: {\n                                kind: CachedRouteKind.APP_ROUTE,\n                                status: response.status,\n                                body: Buffer.from(await blob.arrayBuffer()),\n                                headers\n                            },\n                            cacheControl: {\n                                revalidate,\n                                expire\n                            }\n                        };\n                        return cacheEntry;\n                    } else {\n                        // send response without caching if not ISR\n                        await sendResponse(nodeNextReq, nodeNextRes, response, context.renderOpts.pendingWaitUntil);\n                        return null;\n                    }\n                } catch (err) {\n                    // if this is a background revalidate we need to report\n                    // the request error here as it won't be bubbled\n                    if (previousCacheEntry == null ? void 0 : previousCacheEntry.isStale) {\n                        await routeModule.onRequestError(req, err, {\n                            routerKind: 'App Router',\n                            routePath: srcPage,\n                            routeType: 'route',\n                            revalidateReason: getRevalidateReason({\n                                isRevalidate,\n                                isOnDemandRevalidate\n                            })\n                        }, routerServerContext);\n                    }\n                    throw err;\n                }\n            };\n            const cacheEntry = await routeModule.handleResponse({\n                req,\n                nextConfig,\n                cacheKey,\n                routeKind: RouteKind.APP_ROUTE,\n                isFallback: false,\n                prerenderManifest,\n                isRoutePPREnabled: false,\n                isOnDemandRevalidate,\n                revalidateOnlyGenerated,\n                responseGenerator,\n                waitUntil: ctx.waitUntil\n            });\n            // we don't create a cacheEntry for ISR\n            if (!isIsr) {\n                return null;\n            }\n            if ((cacheEntry == null ? void 0 : (_cacheEntry_value = cacheEntry.value) == null ? void 0 : _cacheEntry_value.kind) !== CachedRouteKind.APP_ROUTE) {\n                var _cacheEntry_value1;\n                throw Object.defineProperty(new Error(`Invariant: app-route received invalid cache entry ${cacheEntry == null ? void 0 : (_cacheEntry_value1 = cacheEntry.value) == null ? void 0 : _cacheEntry_value1.kind}`), \"__NEXT_ERROR_CODE\", {\n                    value: \"E701\",\n                    enumerable: false,\n                    configurable: true\n                });\n            }\n            if (!getRequestMeta(req, 'minimalMode')) {\n                res.setHeader('x-nextjs-cache', isOnDemandRevalidate ? 'REVALIDATED' : cacheEntry.isMiss ? 'MISS' : cacheEntry.isStale ? 'STALE' : 'HIT');\n            }\n            // Draft mode should never be cached\n            if (isDraftMode) {\n                res.setHeader('Cache-Control', 'private, no-cache, no-store, max-age=0, must-revalidate');\n            }\n            const headers = fromNodeOutgoingHttpHeaders(cacheEntry.value.headers);\n            if (!(getRequestMeta(req, 'minimalMode') && isIsr)) {\n                headers.delete(NEXT_CACHE_TAGS_HEADER);\n            }\n            // If cache control is already set on the response we don't\n            // override it to allow users to customize it via next.config\n            if (cacheEntry.cacheControl && !res.getHeader('Cache-Control') && !headers.get('Cache-Control')) {\n                headers.set('Cache-Control', getCacheControlHeader(cacheEntry.cacheControl));\n            }\n            await sendResponse(nodeNextReq, nodeNextRes, new Response(cacheEntry.value.body, {\n                headers,\n                status: cacheEntry.value.status || 200\n            }));\n            return null;\n        };\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await handleResponse(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${req.url}`,\n                    kind: SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, handleResponse));\n        }\n    } catch (err) {\n        if (!(err instanceof NoFallbackError)) {\n            await routeModule.onRequestError(req, err, {\n                routerKind: 'App Router',\n                routePath: normalizedSrcPage,\n                routeType: 'route',\n                revalidateReason: getRevalidateReason({\n                    isRevalidate,\n                    isOnDemandRevalidate\n                })\n            });\n        }\n        // rethrow so that we can handle serving error page\n        // If this is during static generation, throw the error again.\n        if (isIsr) throw err;\n        // Otherwise, send a 500 response.\n        await sendResponse(nodeNextReq, nodeNextRes, new Response(null, {\n            status: 500\n        }));\n        return null;\n    }\n}\n\n//# sourceMappingURL=app-route.js.map\n","var _self___RSC_MANIFEST;\nimport { createServerModuleMap } from \"next/dist/server/app-render/action-utils\";\nimport { setReferenceManifestsSingleton } from \"next/dist/server/app-render/encryption-utils\";\nimport { EdgeRouteModuleWrapper } from \"next/dist/server/web/edge-route-module-wrapper\";\n// Import the userland code.\nimport * as module from \"next-app-loader?name=app%2Fapi%2Fcron%2Fpricing%2Froute&page=%2Fapi%2Fcron%2Fpricing%2Froute&pagePath=private-next-app-dir%2Fapi%2Fcron%2Fpricing%2Froute.ts&appDir=%2FUsers%2Fmarioelysian%2Fimessage-mino-bot%2Fsnap-apps-server%2Fsrc%2Fapp&appPaths=%2Fapi%2Fcron%2Fpricing%2Froute&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=!private-next-app-dir/api/cron/pricing/route.ts?__next_edge_ssr_entry__\";\nconst nextConfig = {\"env\":{},\"webpack\":null,\"eslint\":{\"ignoreDuringBuilds\":false},\"typescript\":{\"ignoreBuildErrors\":false,\"tsconfigPath\":\"tsconfig.json\"},\"typedRoutes\":false,\"distDir\":\".next\",\"cleanDistDir\":true,\"assetPrefix\":\"\",\"cacheMaxMemorySize\":52428800,\"configOrigin\":\"next.config.ts\",\"useFileSystemPublicRoutes\":true,\"generateEtags\":true,\"pageExtensions\":[\"tsx\",\"ts\",\"jsx\",\"js\"],\"poweredByHeader\":true,\"compress\":true,\"images\":{\"deviceSizes\":[640,750,828,1080,1200,1920,2048,3840],\"imageSizes\":[16,32,48,64,96,128,256,384],\"path\":\"/_next/image\",\"loader\":\"default\",\"loaderFile\":\"\",\"domains\":[\"minnow.so\",\"localhost\"],\"disableStaticImages\":false,\"minimumCacheTTL\":60,\"formats\":[\"image/webp\"],\"dangerouslyAllowSVG\":false,\"contentSecurityPolicy\":\"script-src 'none'; frame-src 'none'; sandbox;\",\"contentDispositionType\":\"attachment\",\"remotePatterns\":[{\"protocol\":\"https\",\"hostname\":\"**\"}],\"unoptimized\":false},\"devIndicators\":{\"position\":\"bottom-left\"},\"onDemandEntries\":{\"maxInactiveAge\":60000,\"pagesBufferLength\":5},\"amp\":{\"canonicalBase\":\"\"},\"basePath\":\"\",\"sassOptions\":{},\"trailingSlash\":false,\"i18n\":null,\"productionBrowserSourceMaps\":false,\"excludeDefaultMomentLocales\":true,\"serverRuntimeConfig\":{},\"publicRuntimeConfig\":{},\"reactProductionProfiling\":false,\"reactStrictMode\":true,\"reactMaxHeadersLength\":6000,\"httpAgentOptions\":{\"keepAlive\":true},\"logging\":{},\"compiler\":{},\"expireTime\":31536000,\"staticPageGenerationTimeout\":60,\"modularizeImports\":{\"@mui/icons-material\":{\"transform\":\"@mui/icons-material/{{member}}\"},\"lodash\":{\"transform\":\"lodash/{{member}}\"}},\"outputFileTracingRoot\":\"/Users/marioelysian/imessage-mino-bot\",\"experimental\":{\"useSkewCookie\":false,\"cacheLife\":{\"default\":{\"stale\":300,\"revalidate\":900,\"expire\":4294967294},\"seconds\":{\"stale\":30,\"revalidate\":1,\"expire\":60},\"minutes\":{\"stale\":300,\"revalidate\":60,\"expire\":3600},\"hours\":{\"stale\":300,\"revalidate\":3600,\"expire\":86400},\"days\":{\"stale\":300,\"revalidate\":86400,\"expire\":604800},\"weeks\":{\"stale\":300,\"revalidate\":604800,\"expire\":2592000},\"max\":{\"stale\":300,\"revalidate\":2592000,\"expire\":4294967294}},\"cacheHandlers\":{},\"cssChunking\":true,\"multiZoneDraftMode\":false,\"appNavFailHandling\":false,\"prerenderEarlyExit\":true,\"serverMinification\":true,\"serverSourceMaps\":false,\"linkNoTouchStart\":false,\"caseSensitiveRoutes\":false,\"clientSegmentCache\":false,\"clientParamParsing\":false,\"dynamicOnHover\":false,\"preloadEntriesOnStart\":true,\"clientRouterFilter\":true,\"clientRouterFilterRedirects\":false,\"fetchCacheKeyPrefix\":\"\",\"middlewarePrefetch\":\"flexible\",\"optimisticClientCache\":true,\"manualClientBasePath\":false,\"cpus\":13,\"memoryBasedWorkersCount\":false,\"imgOptConcurrency\":null,\"imgOptTimeoutInSeconds\":7,\"imgOptMaxInputPixels\":268402689,\"imgOptSequentialRead\":null,\"imgOptSkipMetadata\":null,\"isrFlushToDisk\":true,\"workerThreads\":false,\"optimizeCss\":false,\"nextScriptWorkers\":false,\"scrollRestoration\":false,\"externalDir\":false,\"disableOptimizedLoading\":false,\"gzipSize\":true,\"craCompat\":false,\"esmExternals\":true,\"fullySpecified\":false,\"swcTraceProfiling\":false,\"forceSwcTransforms\":false,\"largePageDataBytes\":128000,\"typedEnv\":false,\"parallelServerCompiles\":false,\"parallelServerBuildTraces\":false,\"ppr\":false,\"authInterrupts\":false,\"webpackMemoryOptimizations\":false,\"optimizeServerReact\":true,\"viewTransition\":false,\"routerBFCache\":false,\"removeUncaughtErrorAndRejectionListeners\":false,\"validateRSCRequestHeaders\":false,\"staleTimes\":{\"dynamic\":0,\"static\":300},\"serverComponentsHmrCache\":true,\"staticGenerationMaxConcurrency\":8,\"staticGenerationMinPagesPerWorker\":25,\"cacheComponents\":false,\"inlineCss\":false,\"useCache\":false,\"globalNotFound\":false,\"devtoolSegmentExplorer\":true,\"browserDebugInfoInTerminal\":false,\"optimizeRouterScrolling\":false,\"middlewareClientMaxBodySize\":10485760,\"optimizePackageImports\":[\"lucide-react\",\"date-fns\",\"lodash-es\",\"ramda\",\"antd\",\"react-bootstrap\",\"ahooks\",\"@ant-design/icons\",\"@headlessui/react\",\"@headlessui-float/react\",\"@heroicons/react/20/solid\",\"@heroicons/react/24/solid\",\"@heroicons/react/24/outline\",\"@visx/visx\",\"@tremor/react\",\"rxjs\",\"@mui/material\",\"@mui/icons-material\",\"recharts\",\"react-use\",\"effect\",\"@effect/schema\",\"@effect/platform\",\"@effect/platform-node\",\"@effect/platform-browser\",\"@effect/platform-bun\",\"@effect/sql\",\"@effect/sql-mssql\",\"@effect/sql-mysql2\",\"@effect/sql-pg\",\"@effect/sql-sqlite-node\",\"@effect/sql-sqlite-bun\",\"@effect/sql-sqlite-wasm\",\"@effect/sql-sqlite-react-native\",\"@effect/rpc\",\"@effect/rpc-http\",\"@effect/typeclass\",\"@effect/experimental\",\"@effect/opentelemetry\",\"@material-ui/core\",\"@material-ui/icons\",\"@tabler/icons-react\",\"mui-core\",\"react-icons/ai\",\"react-icons/bi\",\"react-icons/bs\",\"react-icons/cg\",\"react-icons/ci\",\"react-icons/di\",\"react-icons/fa\",\"react-icons/fa6\",\"react-icons/fc\",\"react-icons/fi\",\"react-icons/gi\",\"react-icons/go\",\"react-icons/gr\",\"react-icons/hi\",\"react-icons/hi2\",\"react-icons/im\",\"react-icons/io\",\"react-icons/io5\",\"react-icons/lia\",\"react-icons/lib\",\"react-icons/lu\",\"react-icons/md\",\"react-icons/pi\",\"react-icons/ri\",\"react-icons/rx\",\"react-icons/si\",\"react-icons/sl\",\"react-icons/tb\",\"react-icons/tfi\",\"react-icons/ti\",\"react-icons/vsc\",\"react-icons/wi\"]},\"htmlLimitedBots\":\"[\\\\w-]+-Google|Google-[\\\\w-]+|Chrome-Lighthouse|Slurp|DuckDuckBot|baiduspider|yandex|sogou|bitlybot|tumblr|vkShare|quora link preview|redditbot|ia_archiver|Bingbot|BingPreview|applebot|facebookexternalhit|facebookcatalog|Twitterbot|LinkedInBot|Slackbot|Discordbot|WhatsApp|SkypeUriPreview|Yeti|googleweblight\",\"bundlePagesRouterDependencies\":false,\"configFile\":\"/Users/marioelysian/imessage-mino-bot/snap-apps-server/next.config.ts\",\"configFileName\":\"next.config.ts\",\"turbopack\":{\"root\":\"/Users/marioelysian/imessage-mino-bot\"}}\nconst maybeJSONParse = (str)=>str ? JSON.parse(str) : undefined;\nconst rscManifest = (_self___RSC_MANIFEST = self.__RSC_MANIFEST) == null ? void 0 : _self___RSC_MANIFEST[\"/api/cron/pricing/route\"];\nconst rscServerManifest = maybeJSONParse(self.__RSC_SERVER_MANIFEST);\nif (rscManifest && rscServerManifest) {\n    setReferenceManifestsSingleton({\n        page: \"/api/cron/pricing/route\",\n        clientReferenceManifest: rscManifest,\n        serverActionsManifest: rscServerManifest,\n        serverModuleMap: createServerModuleMap({\n            serverActionsManifest: rscServerManifest\n        })\n    });\n}\nexport const ComponentMod = module;\nexport default EdgeRouteModuleWrapper.wrap(module.routeModule, {\n    nextConfig\n});\n\n//# sourceMappingURL=edge-app-route.js.map\n"],"names":["PricingTierSchema","z","name","price","nullable","period","default","currency","features","highlighted","cta","optional","companyName","url","tiers","hasFreeTier","hasEnterprise","lastUpdated","rawHtml","SAAS_PRICING_DATABASE","category","scrapePricingPage","response","fetch","headers","ok","success","error","status","statusText","html","text","prices","pattern","pricePatterns","match","matchAll","matches","push","uniquePrices","Set","slice","i","length","extractPrice","normalized","toLowerCase","trim","includes","priceMatch","parseFloat","replace","some","t","data","Date","toISOString","Error","message","getNotificationPreferences","userId","kv","get","APNS_KEY_ID","process","env","APNS_TEAM_ID","APNS_BUNDLE_ID","APNS_PRIVATE_KEY","sendPushNotification","deviceToken","payload","console","warn","jwt","generateApnsJwt","apnsPayload","aps","alert","title","body","sound","badge","snapAppId","apnsHost","method","Authorization","priority","JSON","stringify","header","btoa","alg","kid","claims","iss","iat","Math","now","floor","TWILIO_ACCOUNT_SID","TWILIO_AUTH_TOKEN","TWILIO_PHONE_NUMBER","sendSmsNotification","phoneNumber","URLSearchParams","To","From","Body","json","IMESSAGE_BOT_WEBHOOK","sendIMessageNotification","handle","recipient","sendWebhookNotification","webhookUrl","sendNotification","prefs","channels","sentChannels","channel","sent","apnsToken","imessageHandle","getDiffAlertsForSnapApp","alertIds","smembers","alerts","Promise","all","map","id","filter","a","getValueAtPath","obj","path","parts","split","Boolean","current","part","undefined","test","parseInt","processDiffAlerts","oldData","newData","triggeredAlerts","oldValue","field","newValue","shouldTriggerAlert","lastValue","condition","threshold","abs","set","lastTriggeredAt","alertId","CRON_SECRET","KV_PREFIX","PRICING_ALERT_USER_ID","GET","request","authHeader","NextResponse","startTime","results","companies","entry","sadd","e","changedCount","priceChange","dbEntry","find","changed","scraped","pricing","oldPrices","newPrices","oldFirstTier","newFirstTier","old","new","lastChecked","lastChanged","updated","setTimeout","r","duration","changedCompanies","join","changes","summary","total","successful","failed","durationMs","nextRun","runtime"],"sourceRoot":"","ignoreList":[]}