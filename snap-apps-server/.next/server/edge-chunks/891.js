(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[891],{6103:(a,b,c)=>{"use strict";c.d(b,{mE:()=>m,no:()=>k,uH:()=>l,wS:()=>j});var d=c(4501);let e=new Map,f=new Map,g=!!(process.env.KV_REST_API_URL&&process.env.KV_REST_API_TOKEN),h=g?d.kv:{get:async a=>e.get(a)??null,async set(a,b){e.set(a,b)},async del(a){e.delete(a)},async incr(a){let b=(e.get(a)||0)+1;return e.set(a,b),b},async zadd(a,b){let c=f.get(a)||[],d=c.findIndex(a=>a.member===b.member);d>=0?c[d]=b:c.push(b),c.sort((a,b)=>a.score-b.score),f.set(a,c)},async zrem(a,b){let c=f.get(a)||[],d=c.findIndex(a=>a.member===b);d>=0&&(c.splice(d,1),f.set(a,c))},async zrange(a,b,c,d){let e=[...f.get(a)||[]];return d?.rev&&(e=e.reverse()),(e=d?.byScore?e.filter(a=>a.score>=b&&a.score<=c):e.slice(b,c+1)).map(a=>a.member)}};g||console.log("⚠️  Using in-memory storage (KV not configured)");let i={snapApp:a=>`snap:${a}`,publicSnapApps:()=>"public:snaps",scheduledJob:a=>`schedule:${a}`,pendingJobs:()=>"jobs:pending"};async function j(a){return await h.get(i.snapApp(a))}async function k(a,b){let c=await h.get(i.snapApp(a));if(!c)return null;let d={...c,...b,updatedAt:new Date};return await h.set(i.snapApp(a),d),void 0!==b.isPublic&&(b.isPublic&&!c.isPublic?await h.zadd(i.publicSnapApps(),{score:c.createdAt.getTime(),member:a}):!b.isPublic&&c.isPublic&&await h.zrem(i.publicSnapApps(),a)),d}async function l(a=10){let b=Date.now(),c=await h.zrange(i.pendingJobs(),0,b,{byScore:!0});if(!c.length)return[];let d=c.slice(0,a);return(await Promise.all(d.map(a=>h.get(i.scheduledJob(a))))).filter(a=>null!==a&&a.isActive)}async function m(a){let b,c=await h.get(i.scheduledJob(a));if(!c)return;let d=new Date;c.intervalMinutes&&(b=new Date(d.getTime()+60*c.intervalMinutes*1e3));let e={...c,lastRunAt:d,nextRunAt:b};await h.set(i.scheduledJob(a),e),await h.zrem(i.pendingJobs(),a),b&&await h.zadd(i.pendingJobs(),{score:b.getTime(),member:a}),await h.set(i.snapApp(c.snapAppId),{...await j(c.snapAppId),lastRefreshedAt:d,updatedAt:d})}},6487:()=>{},8335:()=>{}}]);
//# sourceMappingURL=891.js.map