"use strict";exports.id=461,exports.ids=[461],exports.modules={50071:(a,b,c)=>{let d,e;c.d(b,{Ak:()=>g});var f=c(77598);function g(a=21){var b;b=a|=0,!d||d.length<b?(d=Buffer.allocUnsafe(128*b),f.webcrypto.getRandomValues(d),e=0):e+b>d.length&&(f.webcrypto.getRandomValues(d),e=0),e+=b;let c="";for(let b=e-a;b<e;b++)c+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&d[b]];return c}},79461:(a,b,c)=>{c.d(b,{AN:()=>C,Ax:()=>F,EV:()=>B,Fi:()=>o,HI:()=>x,HT:()=>q,LJ:()=>L,Mh:()=>H,OQ:()=>A,RN:()=>m,Tc:()=>M,U_:()=>w,Wn:()=>K,ab:()=>I,c7:()=>k,cp:()=>p,d7:()=>v,fF:()=>t,g:()=>D,gR:()=>r,gn:()=>N,hM:()=>O,i0:()=>y,kw:()=>E,lf:()=>s,no:()=>n,wS:()=>l,wu:()=>J});var d=c(99762),e=c(50071);let f=new Map,g=new Map,h=!!(process.env.KV_REST_API_URL&&process.env.KV_REST_API_TOKEN),i=h?d.kv:{get:async a=>f.get(a)??null,async set(a,b){f.set(a,b)},async del(a){f.delete(a)},async incr(a){let b=(f.get(a)||0)+1;return f.set(a,b),b},async zadd(a,b){let c=g.get(a)||[],d=c.findIndex(a=>a.member===b.member);d>=0?c[d]=b:c.push(b),c.sort((a,b)=>a.score-b.score),g.set(a,c)},async zrem(a,b){let c=g.get(a)||[],d=c.findIndex(a=>a.member===b);d>=0&&(c.splice(d,1),g.set(a,c))},async zrange(a,b,c,d){let e=[...g.get(a)||[]];return d?.rev&&(e=e.reverse()),(e=d?.byScore?e.filter(a=>a.score>=b&&a.score<=c):e.slice(b,c+1)).map(a=>a.member)}};h||console.log("⚠️  Using in-memory storage (KV not configured)");let j={snapApp:a=>`snap:${a}`,userSnapApps:a=>`user:${a}:snaps`,publicSnapApps:()=>"public:snaps",scheduledJob:a=>`schedule:${a}`,snapAppSchedule:a=>`snap:${a}:schedule`,pendingJobs:()=>"jobs:pending",viewCount:a=>`views:${a}`,shareCount:a=>`shares:${a}`};async function k(a){let b=(0,e.Ak)(10),c=new Date,d={id:b,type:a.type,title:a.title,subtitle:a.subtitle,sourceUrl:a.sourceUrl,shareUrl:`${process.env.NEXT_PUBLIC_BASE_URL||"https://minnow.so"}/app/${b}`,data:a.data,insights:a.insights,actions:a.actions,creatorId:a.creatorId,creatorName:a.creatorName,createdAt:c,updatedAt:c,viewCount:0,shareCount:0,isPublic:a.isPublic};return await i.set(j.snapApp(b),d),d.isPublic&&await i.zadd(j.publicSnapApps(),{score:c.getTime(),member:b}),d.creatorId&&await i.zadd(j.userSnapApps(d.creatorId),{score:c.getTime(),member:b}),d}async function l(a){return await i.get(j.snapApp(a))}async function m(a){let b=await i.get(j.snapApp(a));if(b){await i.incr(j.viewCount(a));let c=await i.get(j.viewCount(a));return c&&c%10==0&&await i.set(j.snapApp(a),{...b,viewCount:c,updatedAt:new Date}),{...b,viewCount:c||b.viewCount}}return null}async function n(a,b){let c=await i.get(j.snapApp(a));if(!c)return null;let d={...c,...b,updatedAt:new Date};return await i.set(j.snapApp(a),d),void 0!==b.isPublic&&(b.isPublic&&!c.isPublic?await i.zadd(j.publicSnapApps(),{score:c.createdAt.getTime(),member:a}):!b.isPublic&&c.isPublic&&await i.zrem(j.publicSnapApps(),a)),d}async function o(a){let b=await i.get(j.snapApp(a));return!!b&&(await Promise.all([i.del(j.snapApp(a)),i.del(j.viewCount(a)),i.del(j.shareCount(a)),i.zrem(j.publicSnapApps(),a),b.creatorId?i.zrem(j.userSnapApps(b.creatorId),a):Promise.resolve()]),!0)}async function p(a){let b=await i.incr(j.shareCount(a));if(b%5==0){let c=await i.get(j.snapApp(a));c&&await i.set(j.snapApp(a),{...c,shareCount:b,updatedAt:new Date})}return b}async function q(a=20,b=0){let c=await i.zrange(j.publicSnapApps(),b,b+a-1,{rev:!0});return c.length?(await Promise.all(c.map(a=>l(a)))).filter(a=>null!==a):[]}async function r(a,b=50,c=0){let d=await i.zrange(j.userSnapApps(a),c,c+b-1,{rev:!0});return d.length?(await Promise.all(d.map(a=>l(a)))).filter(a=>null!==a):[]}async function s(a,b){let c,d=(0,e.Ak)(10),f=new Date;c=new Date(b.intervalMinutes?f.getTime()+60*b.intervalMinutes*1e3:f.getTime()+36e5);let g={id:d,snapAppId:a,cronExpression:b.cronExpression,intervalMinutes:b.intervalMinutes,webhookUrl:b.webhookUrl,nextRunAt:c,isActive:!0,createdAt:f};await i.set(j.scheduledJob(d),g),await i.set(j.snapAppSchedule(a),d),await i.zadd(j.pendingJobs(),{score:c.getTime(),member:d});let h=await l(a);return h&&(await n(a,{}),await i.set(j.snapApp(a),{...h,scheduleId:d,refreshInterval:b.intervalMinutes})),g}async function t(a){let b=await i.get(j.scheduledJob(a));if(!b)return;await i.set(j.scheduledJob(a),{...b,isActive:!1}),await i.zrem(j.pendingJobs(),a),await i.set(j.snapAppSchedule(b.snapAppId),null);let c=await l(b.snapAppId);c&&await i.set(j.snapApp(b.snapAppId),{...c,scheduleId:void 0,refreshInterval:void 0})}let u={preferences:a=>`investor:${a}:preferences`,feedback:a=>`investor:${a}:feedback`,feedbackItem:a=>`feedback:${a}`,allFeedback:()=>"feedback:all"};async function v(a){return await i.get(u.preferences(a))}async function w(a,b){let c=await v(a),d=new Date,e={investorId:a,briefSchedule:{enabled:!0,time:"06:00",timezone:"America/Los_Angeles",weekdaysOnly:!1,daysOfWeek:[1,2,3,4,5]},notifications:{criticalAlerts:!0,dailyDigest:!0,weeklyReport:!1},displayPreferences:{showAllNews:!0,compactView:!1,priorityThreshold:"all"},createdAt:c?.createdAt||d,updatedAt:d},f={...e,...c,...b,investorId:a,briefSchedule:{...e.briefSchedule,...c?.briefSchedule,...b.briefSchedule},notifications:{...e.notifications,...c?.notifications,...b.notifications},displayPreferences:{...e.displayPreferences,...c?.displayPreferences,...b.displayPreferences},updatedAt:d,createdAt:c?.createdAt||d};return await i.set(u.preferences(a),f),f}async function x(a,b){let c=(0,e.Ak)(10),d=new Date,f={id:c,investorId:a,type:b.type,message:b.message,context:b.context,status:"pending",createdAt:d};return await i.set(u.feedbackItem(c),f),await i.zadd(u.feedback(a),{score:d.getTime(),member:c}),await i.zadd(u.allFeedback(),{score:d.getTime(),member:c}),f}async function y(a,b=20){let c=await i.zrange(u.feedback(a),0,b-1,{rev:!0});return c.length?(await Promise.all(c.map(a=>i.get(u.feedbackItem(a))))).filter(a=>null!==a):[]}let z={state:a=>`investor:${a}:state`};async function A(a){return await i.get(z.state(a))}async function B(a,b){let c=await A(a);if(c)return c;let d=new Date,f=b.split(" ")[0],g={investorId:a,stage:"new",hasCompletedOnboarding:!1,searchCount:0,snapAppCount:0,conversationHistory:[{id:(0,e.Ak)(8),role:"assistant",content:`${f}, we've been expecting you.

I'm Mino, your portfolio intelligence agent. I can help you:

• **Search** for insights on your portfolio companies
• **Create Snap Apps** - live dashboards from any search
• **Manage settings** through natural conversation

What would you like to explore first?`,timestamp:d,metadata:{intent:"general"}}],createdAt:d,updatedAt:d};return await i.set(z.state(a),g),g}async function C(a,b){let c=await A(a);if(!c)return null;let d=new Date,e={...c,stage:"new"===c.stage?"searched":c.stage,searchCount:c.searchCount+1,lastSearchQuery:b,lastSearchAt:d,updatedAt:d};return await i.set(z.state(a),e),e}async function D(a){let b=await A(a);if(!b)return null;let c=new Date,d={...b,stage:"created_app",snapAppCount:b.snapAppCount+1,hasCompletedOnboarding:!0,updatedAt:c};return await i.set(z.state(a),d),d}async function E(a,b){let c=await A(a);if(!c)return null;let d=new Date,f={...b,id:(0,e.Ak)(8),timestamp:d},g=[...c.conversationHistory,f].slice(-50),h={...c,conversationHistory:g,updatedAt:d};return await i.set(z.state(a),h),h}function F(a){return a.searchCount>0}let G={subscription:a=>`briefing:${a}`,userSubscriptions:a=>`user:${a}:briefings`,allActiveSubscriptions:()=>"briefings:active",delivery:a=>`delivery:${a}`,subscriptionDeliveries:a=>`briefing:${a}:deliveries`};async function H(a){let b=(0,e.Ak)(10),c=new Date,d={...a,id:b,isActive:!0,createdAt:c,updatedAt:c};return await i.set(G.subscription(b),d),await i.zadd(G.userSubscriptions(a.userId),{score:c.getTime(),member:b}),d.schedule.enabled&&await i.zadd(G.allActiveSubscriptions(),{score:c.getTime(),member:b}),d}async function I(a){return i.get(G.subscription(a))}async function J(a){let b=await i.zrange(G.userSubscriptions(a),0,-1,{rev:!0});return b.length?(await Promise.all(b.map(a=>I(a)))).filter(a=>null!==a):[]}async function K(){let a=await i.zrange(G.allActiveSubscriptions(),0,-1);return a.length?(await Promise.all(a.map(a=>I(a)))).filter(a=>null!==a&&a.isActive&&a.schedule.enabled):[]}async function L(a,b){let c=await I(a);if(!c)return null;let d={...c,...b,updatedAt:new Date};return await i.set(G.subscription(a),d),d.isActive&&d.schedule.enabled?await i.zadd(G.allActiveSubscriptions(),{score:d.createdAt.getTime(),member:a}):await i.zrem(G.allActiveSubscriptions(),a),d}async function M(a){let b=await I(a);return!!b&&(await Promise.all([i.del(G.subscription(a)),i.zrem(G.userSubscriptions(b.userId),a),i.zrem(G.allActiveSubscriptions(),a)]),!0)}async function N(a,b,c,d,f){let g=(0,e.Ak)(10),h=new Date,j={id:g,subscriptionId:a,content:b,newsItems:c,deliveredAt:h,status:d,error:f};return await i.set(G.delivery(g),j),await i.zadd(G.subscriptionDeliveries(a),{score:h.getTime(),member:g}),"sent"===d&&await L(a,{lastDeliveredAt:h}),j}async function O(a,b=10){let c=await i.zrange(G.subscriptionDeliveries(a),0,b-1,{rev:!0});return c.length?(await Promise.all(c.map(a=>i.get(G.delivery(a))))).filter(a=>null!==a):[]}}};